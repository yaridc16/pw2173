(function(window){
/*! 1.39.0 - Lajos Meszaros.master.4460978b0a0 */

function DUMMY(){}function FALSE(){return false}function TRUE(){return true}function and(a,b){return function(){return a.apply(a,arguments)&&b.apply(b,arguments)}}function not(func){return function(){return!func.apply(func,arguments)}}function equals(compareWith){return function(what){return what===compareWith}}function sum(a,b){return a+b}function sumArray(a,b){return a.concat(b)}function toInt(current){return parseInt(current)}function hasProp(key){return function(object){return object.hasOwnProperty(key)}}function isPropOf(object){return function(key){return object.hasOwnProperty(key)}}function prop(key){return function(object){return object[key]}}function propOf(object){return function(key){return object[key]}}function compose(){var functions=Array.from(arguments);return function(){var self=this;return functions.reduceRight(function(args,func){return[func.apply(self,args)]},arguments)[0]}}(function(){"use strict";if(!Array.prototype.find){Array.prototype.find=function(predicate){if(this===null){throw new TypeError("Array.prototype.find called on null or undefined")}if(typeof predicate!=="function"){throw new TypeError("predicate must be a function")}var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];var value;for(var i=0;i<length;i++){value=list[i];if(predicate.call(thisArg,value,i,list)){return value}}return undefined}}if(!Array.prototype.reduce){Array.prototype.reduce=function(callback){if(this==null){throw new TypeError("Array.prototype.reduce called on null or undefined")}if(typeof callback!=="function"){throw new TypeError(callback+" is not a function")}var t=Object(this),len=t.length>>>0,k=0,value;if(arguments.length==2){value=arguments[1]}else{while(k<len&&!(k in t)){k++}if(k>=len){throw new TypeError("Reduce of empty array with no initial value")}value=t[k++]}for(;k<len;k++){if(k in t){value=callback(value,t[k],k,t)}}return value}}if(!Object.values){Object.values=function(O){return Object.keys(O).reduce(function(v,k){return v.concat(typeof k==="string"&&O.propertyIsEnumerable(k)?[O[k]]:[])},[])}}if(!Object.entries){Object.entries=function(O){return Object.keys(O).reduce(function(e,k){return e.concat(typeof k==="string"&&O.propertyIsEnumerable(k)?[[k,O[k]]]:[])},[])}}if(!Object.assign){Object.assign=function(target){"use strict";if(target==null){throw new TypeError("Cannot convert undefined or null to object")}target=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!=null){for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}}return target}}if(!Array.from){Array.from=function(){var toStr=Object.prototype.toString;var isCallable=function(fn){return typeof fn==="function"||toStr.call(fn)==="[object Function]"};var toInteger=function(value){var number=Number(value);if(isNaN(number)){return 0}if(number===0||!isFinite(number)){return number}return(number>0?1:-1)*Math.floor(Math.abs(number))};var maxSafeInteger=Math.pow(2,53)-1;var toLength=function(value){var len=toInteger(value);return Math.min(Math.max(len,0),maxSafeInteger)};return function from(arrayLike){var C=this;var items=Object(arrayLike);if(arrayLike==null){throw new TypeError("Array.from requires an array-like object - not null or undefined")}var mapFn=arguments.length>1?arguments[1]:void undefined;var T;if(typeof mapFn!=="undefined"){if(!isCallable(mapFn)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){T=arguments[2]}}var len=toLength(items.length);var A=isCallable(C)?Object(new C(len)):new Array(len);var k=0;var kValue;while(k<len){kValue=items[k];if(mapFn){A[k]=typeof T==="undefined"?mapFn(kValue,k):mapFn.call(T,kValue,k)}else{A[k]=kValue}k+=1}A.length=len;return A}}()}if(!Array.prototype.fill){Array.prototype.fill=function(value){if(this==null){throw new TypeError("this is null or not defined")}var O=Object(this);var len=O.length>>>0;var start=arguments[1];var relativeStart=start>>0;var k=relativeStart<0?Math.max(len+relativeStart,0):Math.min(relativeStart,len);var end=arguments[2];var relativeEnd=end===undefined?len:end>>0;var final=relativeEnd<0?Math.max(len+relativeEnd,0):Math.min(relativeEnd,len);while(k<final){O[k]=value;k++}return O}}(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent})();var console=window.console;var logFns=["log","info","warn","error","assert","dir","clear","profile","profileEnd"];if(typeof console=="undefined"){console={}}for(var i=0;i<logFns.length;i++){var method=logFns[i];if(typeof console[method]=="undefined"){console[method]=DUMMY}}if(typeof console=="object"&&typeof console.log=="object"){for(var i=0;i<logFns.length;i++){var method=logFns[i];console[method]=Function.prototype.call.bind(console[method],console)}}window.console=console})();var isLocalStorageSupported=false;try{isLocalStorageSupported="localStorage"in window&&typeof window.localStorage==="object"&&"setItem"in window.localStorage}catch(e){window.console.warn("Spieler: localStorage cannot be accessed possibly due to disabled cookies")}var isDebugEnabled=isLocalStorageSupported&&window.localStorage.getItem("debug")==="enabled";var isHlsJsDebugEnabled=isLocalStorageSupported&&window.localStorage.getItem("debugHlsjs")==="enabled";var isBenchmarkEnabled=isLocalStorageSupported&&window.localStorage.getItem("benchmark")==="enabled";var console={log:isDebugEnabled?window.console.log.bind(window.console):DUMMY,warn:isDebugEnabled?window.console.warn.bind(window.console):DUMMY,error:isDebugEnabled?window.console.error.bind(window.console):DUMMY,info:isDebugEnabled?window.console.info.bind(window.console):DUMMY};var utils;(function(){"use strict";function createIEObject(url,params){params.movie=url;var paramList="";for(var i in params){paramList+='<param name="'+i+'" value="'+params[i]+'">'}var div=document.createElement("div");div.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000">'+paramList+"</object>";return div.firstChild}function createObject(url,params){var obj=document.createElement("object");obj.setAttribute("type","application/x-shockwave-flash");obj.setAttribute("data",url);for(var i in params){var param=document.createElement("param");param.setAttribute("name",i);param.setAttribute("value",params[i]);obj.appendChild(param)}return obj}function removeIEObject(obj){if(obj.readyState){if(obj.readyState===4||obj.readyState==="complete"){for(var i in obj){if(typeof obj[i]==="function"){obj[i]=null}}removeObject(obj)}else{setTimeout(function(){removeIEObject(obj)},100)}}else{removeObject(obj)}}function removeObject(obj){obj.parentNode.removeChild(obj)}function isPlainObject(obj){if(!obj||obj.toString()!=="[object Object]"){return false}var hasOwnConstructor=obj.hasOwnProperty("constructor");var hasIsPrototypeOf=obj.constructor&&obj.constructor.prototype&&obj.constructor.prototype.hasOwnProperty("isPrototypeOf");if(obj.constructor&&!hasOwnConstructor&&!hasIsPrototypeOf){return false}var key;for(key in obj){}return typeof key==="undefined"||obj.hasOwnProperty(key)}function extend(){var options,name,src,copy,copyIsArray,clone;var target=arguments[0];var i=1;var length=arguments.length;var deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}else if(typeof target!=="object"&&typeof target!=="function"||target==null){target={}}for(;i<length;++i){options=arguments[i];if(options!=null){for(name in options){src=target[name];copy=options[name];if(target!==copy){if(deep&&copy&&(isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&Array.isArray(src)?src:[]}else{clone=src&&isPlainObject(src)?src:{}}target[name]=extend(deep,clone,copy)}else if(typeof copy!=="undefined"){target[name]=copy}}}}}return target}utils={extend:extend,cloneObject:function(o){return this.extend({},o)},deprecate:function(obj,key,name){var notificationSent=false;var value=typeof obj[key]==="function"?obj[key].bind(obj):obj[key];Object.defineProperty&&Object.defineProperty(obj,key,{get:function(){if(!notificationSent){console.warn("Spieler: "+name+" is now deprecated"+"and will be removed in the next major version.");notificationSent=true}return value},set:DUMMY})},isEmptyVideo:function(videoElement){return videoElement.getAttribute("src")===""},resetVideoElement:function(videoElement){videoElement.setAttribute("style","")},embedFlash:function(url,params,attrs){var isOldIE=Spieler.browser.is.ie!==false&&Spieler.browser.is.ie<11;var obj=(isOldIE?createIEObject:createObject)(url,params);if(attrs){for(var i in attrs){obj.setAttribute(i,attrs[i])}}return obj},deleteFlash:function(obj){var isOldIE=Spieler.browser.is.ie!==false&&Spieler.browser.is.ie<11;if(isOldIE){obj.style.display="none";removeIEObject(obj)}else{removeObject(obj)}},isHTTPS:function(){return window.location.protocol==="https:"},bindAll:function(obj){var key;for(key in obj){if(typeof obj[key]==="function"){obj[key]=obj[key].bind(obj)}}},safeToString:function(x){var type=typeof x;switch(typeof x){case"object":if(Array.isArray(x))return x.join(", ");if(x===null)return"null";return"object";case"function":return"function";default:return x+""}},toZeroString:function(variable){var ret=variable!==undefined&&!(typeof variable==="number"&&isNaN(variable))&&[null,Infinity].indexOf(variable)===-1&&!Array.isArray(variable)?""+variable:"";if(ret==="[object Object]"){ret=""}return ret},randomNumber:function(){return Math.floor(Math.random()*1e6)},addCacheBuster:function(url){if(url.indexOf("?")!==-1){var urlParts=url.split("?");urlParts[1]=urlParts[1].replace(/(?:^|&)random=(?:[^&]*|$)/,"");url=urlParts[1]!==""?urlParts.join("?"):urlParts[0]}url+=(url.indexOf("?")!==-1?"&":"?")+"random="+utils.randomNumber();return url}}})();var dom;(function(){"use strict";dom={prop:function(element,propertyName,value){if(value!==undefined){if(value){element.setAttribute(propertyName,propertyName)}else{element.removeAttribute(propertyName)}element[propertyName]=value}return element[propertyName]},on:function(element,eventName,handler,useCapture){element.addEventListener(eventName,handler,useCapture||false);return this},once:function(element,eventName,handler,useCapture){handler._called=false;var self=this;handler._onceWrapper=function(element,eventName,handler,useCapture){return function(){if(!handler._called){handler._called=true;self.off(element,eventName,handler._onceWrapper,useCapture);handler.apply(handler,Array.from(arguments))}}}(element,eventName,handler,useCapture);this.on(element,eventName,handler._onceWrapper,useCapture);return this},ready:function(handler){if(["interactive","complete"].find(equals(document.readyState))){handler()}else{this.once(document,"readystatechange",handler)}},off:function(element,eventName,handler,useCapture){element.removeEventListener(eventName,handler,useCapture||false);return this},text:function(element,content){if(content){element.textContent=content;return this}else{return element.textContent}},createElement:function(tag,attributes,children){var attributes=attributes||{};var children=children||[];var element=document.createElement(tag);Object.keys(attributes).forEach(function(attribute){var value=attributes[attribute];switch(attribute){case"text":element.textContent=value;break;case"html":element.innerHTML=value;break;case"data":for(var attr in value){element.setAttribute("data-"+attr,value[attr])}break;case"on":if(typeof value==="object"){Object.entries(value).forEach(function(kvPair){var eventName=kvPair[0];var handler=kvPair[1];element.addEventListener(eventName,handler)})}break;default:element.setAttribute(attribute,value)}});children.forEach(function(child){if(typeof child==="string"){child=document.createTextNode(child)}element.appendChild(child)});return element},addToHead:function(element){document.querySelector("head").appendChild(element);return element},removeFromHead:function(element){try{return document.querySelector("head").removeChild(element)}catch(e){console.warn(e);return}}};dom.addCSS=function(style,inline){var inline=inline||false;if(inline){var css=dom.addToHead(dom.createElement("style"));try{css.innerHTML=style}catch(e){css.styleSheet.cssText=style}}else{dom.addToHead(dom.createElement("link",{type:"text/css",rel:"stylesheet",href:style}))}};dom.addScript=function(url,onSuccess,onError){var element=dom.createElement("script",{src:url,type:"text/javascript",on:{load:onSuccess||DUMMY,error:onError||DUMMY}});return dom.addToHead(element)};dom.hide=function(what){dom.addClass(what,"hidden")};dom.show=function(what){dom.removeClass(what,"hidden")};if(!("classList"in document.createElement("div"))){var toWordWrapRegex=function(word,flags){return new RegExp("(?:\\s+|^)"+word+"(?:\\s+|$)",utils.toZeroString(flags))};dom.hasClass=function(element,className){return toWordWrapRegex(className).test(element.className)};dom.removeClass=function(element,className){element.className=element.className.replace(toWordWrapRegex(className,"g")," ").trim()};dom.addClass=function(){var args=Array.from(arguments);var element=args.shift();if(!element)return;var c=element.className.split(/\s+/);args.forEach(function(className){className=utils.toZeroString(className);if(className.length>0&&c.indexOf(className)===-1){c.push(className)}});element.className=c.join(" ")}}else{dom.hasClass=function(element,className){return element.classList.contains(className)};dom.removeClass=function(element,className){element.classList.remove(className)};dom.addClass=function(){var args=Array.from(arguments);var element=args.shift();if(!element)return;args.forEach(function(className){element.classList.add(className)})}}})();(function(window){"use strict";if(window.Spieler&&!window.SpielerOverride){return}var instances={};var Spieler=function(element,resources,rawConfig){var log=console.log.bind(console,"Spieler:");var info=console.info.bind(console,"Spieler:");var warn=console.warn.bind(console,"Spieler:");var error=console.error.bind(console,"Spieler:");log("creating new instance");var config=rawConfig||{};var self=this;var upid=config.upid||"upid_"+utils.randomNumber();var elements={};var screen;var ui;var dispatcher=new Dispatcher;var hooks=new HookManager;var ncm;var nfm;var inHTML5FS;var poster;var state={playState:"stopped",playing:config.autoplay!==undefined?config.autoplay:true,posterClicked:true,uninitialized:true,finishedPlayback:false,muted:config.muted!==undefined?config.muted:false,volume:config.volume!==undefined?config.volume:.8,passive:false,mobileAutoplay:false,playsInline:config.playsInline!==undefined?config.playsInline:false,pRate:1,poked:false,poking:false};function hidePoster(){if(Spieler.browser.is.firefox){elements.video.poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAMSURBVBhXY2BgYAAAAAQAAVzN/2kAAAAASUVORK5CYII="}else{elements.video.removeAttribute("poster")}}function showPoster(){elements.video.poster=Spieler.browser.is.iOS!==false?utils.addCacheBuster(config.poster):config.poster}function warnAboutFlashAndNative(){if(config.denyFlash!==true&&Spieler.browser.has.flash()&&(ncm||nfm)){var n=[];if(ncm)n.push("native controls");if(nfm)n.push("native fullscreen");var isAre=!ncm&&nfm?"is":"are";var msg="native fullscreen/controls are not supported with Flash!";var reason=" (flash is enabled for content, while "+n.join(" and ")+" "+isAre+" also enabled)";error(msg+reason)}}function onUiLoaded(){var uiClass=SpielerBasicUI(dom,utils);if(config.nativeFullscreen){config.basicUi.nativeFullscreen=config.nativeFullscreen}ui=new uiClass(elements.ui,self,config.basicUi,state);log("BASICUI loaded");if(self.duration()!=-1){ui.handleDurationChange("",self.duration())}}function createBasicUI(){if(config.basicUi===true){config.basicUi={}}if(config.basicUi&&!ui){dom.addScript(Spieler.path+"basicui.js",onUiLoaded)}}function init(resources,done){if(!resources){warn("halted initialization since given resource is empty");return}if(screen&&!screen.isDestroyed()){screen.destroy();screen=null}dom.prop(elements.video,"playsinline",state.playsInline||state.mobileAutoplay&&Spieler.browser.is.iOS>=10);state.volume=setVideoElementVolume(elements.video,state.volume);pokeVideo("init");state.uninitialized=false;state.playing=true;benchmark.log("spieler","init");if(hooks.isEnabled("pre-init")){dispatcher.dispatch(Spieler.events.PLAY)}hidePoster();hooks.exec("pre-init",{resources:resources,configOverrides:{}},function(err,data){var configOverrides=data&&data.configOverrides;if(configOverrides){self._configOverrides=data.configOverrides}if(err){error("pre-init hook failed.",err);return}if(configOverrides&&configOverrides.denyFlash===true){if(config.denyFlash!==true){warn("overriding denyFlash with "+configOverrides.denyFlash+" (was "+config.denyFlash+")");config.denyFlash=configOverrides.denyFlash}}log("cleaning up video element after pre-init");utils.resetVideoElement(elements.video);loadMedia(resources,function(){if(Spieler.browser.is.IOS||Spieler.browser.is.OSX){if(Spieler.browser.fs.isFullscreenElement(elements.main)||nfm&&nfm.inFullscreen()){dispatcher.dispatch(Spieler.events.PLAY)}}if(typeof done==="function"){done()}})})}function onMediaReady(resources,done,media){log("initializing media",media);if(typeof resources==="object"||typeof resources==="string"){if(resources.metadata&&resources.metadata.tokenized){log("resources.metadata && resources.metadata.tokenized");hooks.exec("streamurl-needed",resources,function(err,newResources){if(err||!newResources){error("streamurl-needed hook failed.")}else{media.load(newResources)}})}else{media.load(resources)}}else{error("invalid, or no media specified")}if(typeof done==="function"){done()}}function loadMedia(resources,done){log("initializing resources",resources);self.media=new Media(config.denyFlash,dispatcher,onMediaReady.bind(null,resources,done))}function onMediaPlatformChange(eventName,params){var media=params.media;benchmark.log("spieler","screen");if(screen&&!screen.isDestroyed()){screen.destroy();screen=null}var flashPlatform=media.isFlashBasedPlatform();if(flashPlatform===true){screen=new FlashScreen(elements.view,self,media,config.acceleration)}else if(flashPlatform===false){screen=new TagScreen(elements.view,self,media,state);if(config.forceFullscreen){self.fullscreen()}}else{dispatcher.dispatch(Spieler.events.UNSUPPORTEDFORMAT)}}function isPlayingSupportedFormat(){var allPlatforms=Object.values(Media.PLATFORM).reduce(sum,0);return(allPlatforms&self.media.platform())>0}function onInitComplete(previousUninitialized){if(self.getPassiveState()||self.media!==undefined&&isPlayingSupportedFormat()){dispatcher.dispatch(Spieler.events.PLAY)}else{state.uninitialized=previousUninitialized;utils.resetVideoElement(elements.main)}}function pokeVideo(comment){var pokingDone=function(){self.muted(false);state.poked=true;state.poking=false;unblockPlaysinlineState();if(!state.playing){setTimeout(function(){elements.video.pause()},0)}log("pokeVideo[ "+comment+" ] success");benchmark.log("spieler","pokeVideo","success @"+comment);removePokeEvents()};benchmark.log("spieler","pokeVideo","@"+comment);if(state.poking){benchmark.log("spieler","pokeVideo","abort, poking in progress @"+comment);log("pokeVideo[ "+comment+" ] abort, poking in progress.");return}if(!Spieler.browser.is.smartphone||Spieler.browser.is.firefox||state.poked){benchmark.log("spieler","pokeVideo","not needed @"+comment);log("pokeVideo[ "+comment+" ] not needed.");return}if(Spieler.userInteraction===false&&!elements.video.controls){benchmark.log("spieler","pokeVideo","failed, userInteraction = false @"+comment);error("pokeVideo[ "+comment+" ] poking the video has to be done in response to a UI interaction.");return}if(Spieler.browser.is.iOS||Spieler.browser.is.android||(self.hooks.isEnabled("pre-init")||self.hooks.isEnabled("streamurl-needed"))){log("pokeVideo[ "+comment+" ] trying to poke");var playPromise=elements.video.play();if(typeof playPromise!=="undefined"&&"then"in playPromise&&typeof playPromise.then==="function"){state.poking=true;playPromise.then(function(){pokingDone()}).catch(function(reason){if(reason.name==="AbortError"){pokingDone()}else{state.poking=false;error("pokeVideo[ "+comment+" ] failed. ",reason);benchmark.log("spieler","pokeVideo","failed, in promise @"+comment)}})}else{pokingDone()}}}var pokeEvents=[Spieler.events.PLAY,Spieler.events.PLAYING,Spieler.events.FULLSCREEN,Spieler.events.PAUSED,Spieler.events.MUTEDCHANGE];function registerPoke(eventName){if(!state.poked&&!state.poking){pokeVideo(eventName+" event")}}function addPokeEvents(){pokeEvents.forEach(function(evt){dispatcher.add(evt,registerPoke)})}function removePokeEvents(){pokeEvents.forEach(function(evt){dispatcher.remove(evt,registerPoke)})}function reinit(done){if(screen&&(!screen.isDestroyed()||config.nativeControls)){screen.destroy();screen=null}var previousUninitialized=state.uninitialized;state.posterClicked=true;state.finishedPlayback=false;init(resources,function(){if(self.media!==undefined&&isPlayingSupportedFormat()||self.media===undefined&&hooks.isEnabled("pre-init")){dispatcher.dispatch(Spieler.events.PLAY)}else{state.uninitialized=previousUninitialized;state.posterClicked=false;showPoster()}if(typeof done==="function"){done()}})}function initPlugins(){if(typeof config.plugins==="object"){for(var plugin in config.plugins){if(config.plugins[plugin]){if(Spieler.plugins[plugin]){try{Spieler.plugins[plugin](self,elements,config.plugins[plugin])}catch(e){error("failed to initialize plugin: "+plugin,e)}}else{warn("plugin not loaded: "+plugin)}}}}}function onUserGesture(event){pokeVideo("userGesture")}function addEventListeners(){elements.main.addEventListener("touchend",onUserGesture,true);addPokeEvents()}function removeEventListeners(){elements.main.removeEventListener("touchend",onUserGesture);removePokeEvents()}function finishConstructor(){var networkStatus=true;var networkTimer=setInterval(function(){if(navigator.onLine===false&&networkStatus===true){log("OFFLINE");dispatcher.dispatch(Spieler.events.OFFLINE)}networkStatus=navigator.onLine},1e3);benchmark.log("spieler","loaded");info("loaded "+benchmark.measure("spieler","start","loaded")+"ms")}function initDOM(element,state){dom.addCSS(mainCSS,true);var r={};r.main=document.createElement("div");r.main.className="ppMain";element.appendChild(r.main);element=r.main;r.view=document.createElement("div");r.view.className="ppView";element.appendChild(r.view);var video=document.createElement("video");utils.resetVideoElement(video);dom.prop(video,"playsinline",state.playsInline||state.mobileAutoplay&&Spieler.browser.is.iOS>=10);dom.prop(video,"autoplay",state.playing);dom.prop(video,"muted",state.muted);r.view.appendChild(video);r.video=video;var videoBackCover=document.createElement("div");videoBackCover.className="backcover";r.view.appendChild(videoBackCover);r.videoBackCover=videoBackCover;r.ui=document.createElement("div");r.ui.className="ppUi";element.appendChild(r.ui);return r}function unblockPlaysinlineState(){dom.prop(elements.video,"playsinline",state.playsInline);dom.prop(elements.video,"autoplay",false);dom.prop(elements.video,"muted",false);state.mobileAutoplay=false}function setVideoElementVolume(video,value){video.volume=value;if(video.volume!==value){info("volume didn't change. requested: "+value+", video:"+video.volume)}return video.volume}this.playState=function(){return state.playState};this.play=function(newResources,internal,noPreInit){if(!newResources&&state.playState==="paused"){this.resume();return}var previousUninitialized=state.uninitialized;var bindedOnInitComplete=onInitComplete.bind(null,previousUninitialized);if(newResources){if(!internal){dispatcher.dispatch(Spieler.events.MEDIACHANGE,newResources)}setTimeout(function(){resources=newResources;if(noPreInit){loadMedia(newResources,bindedOnInitComplete)}else{init(newResources,bindedOnInitComplete)}},500)}else if(resources){if(state.uninitialized){if(config.nativeControls){dispatcher.dispatch(Spieler.events.PLAY,{feedback:true})}else{init(resources,bindedOnInitComplete)}}else if(state.finishedPlayback){reinit(bindedOnInitComplete)}}};this.resume=function(){state.playing=true;if(state.newIosDelayedUnblock||state.mobileAutoplay&&Spieler.userInteraction){state.newIosDelayedUnblock=undefined;unblockPlaysinlineState()}if(this.dfp&&this.dfp.isVideoAdBeingPlayed()){this.dfp.resume()}else if(screen){screen.resume();dispatcher.dispatch(Spieler.events.PLAY)}};this.pause=function(){if(!state.poking){dispatcher.dispatch(Spieler.events.PAUSE)}if(state.mobileAutoplay&&Spieler.userInteraction){if(Spieler.browser.is.iOS>=10){state.newIosDelayedUnblock=true}else{unblockPlaysinlineState()}}};this.currentTime=function(value){return screen?screen.currentTime(value):-1};this.buffered=function(){return screen?screen.buffered():-1};this.duration=function(){return screen?screen.duration():-1};this.volume=function(value){if(value!==undefined&&state.volume!==value){if(state.mobileAutoplay&&Spieler.userInteraction){unblockPlaysinlineState()}if(screen){state.volume=screen.volume(value)}else{state.volume=setVideoElementVolume(elements.video,value)}dispatcher.dispatch(Spieler.events.VOLUMECHANGE,state.volume)}return state.volume};this.muted=function(value){if(value!==undefined&&state.muted!==value){if(state.mobileAutoplay&&Spieler.userInteraction){unblockPlaysinlineState()}if(screen){state.muted=screen.muted(value)}else{state.muted=value}dispatcher.dispatch(Spieler.events.MUTEDCHANGE,state.muted)}return state.muted};this.quality=function(value){var retValue;if(this.absAvailable()){if(this.mbsAvailable()){if(value===undefined){retValue=screen?screen.quality():0}else{if(self.media&&(self.media.platform()&Media.PLATFORM.HLSJS)>0&&screen instanceof TagScreen||screen instanceof FlashScreen){screen.abs(false);screen.quality(value)}}}else{retValue=-1}}else{if(self.media){if(value===undefined){retValue=self.media.quality()}else{if(value<0||value>self.media.qualities()-1){retValue=-1}else{var lastCurrentTime=this.currentTime();self.media.quality(value);dispatcher.dispatch(Media.events.PLATFORMCHANGE,{media:self.media});if(lastCurrentTime>0){dom.addClass(elements.video,"seek-hidden");dispatcher.addOnce(Spieler.events.DURATIONCHANGE,function(){log("quality seek",lastCurrentTime);self.currentTime(lastCurrentTime);lastCurrentTime=0});setTimeout(function(){dom.removeClass(elements.video,"seek-hidden")},500)}dispatcher.dispatch(Spieler.events.QUALITY)}}}else{retValue=0}}return retValue};this.qualityList=function(){if(this.mbsAvailable()&&screen){return screen.qualityList()}if(!this.absAvailable()&&self.media){return self.media.qualityList()}return[]};this.qualities=function(){if(this.mbsAvailable()&&screen){return screen.qualities()}if(!this.absAvailable()&&self.media){return self.media.qualities()}return 1};this.abs=function(value){return screen?screen.abs(value):false};this.absAvailable=function(){return self.media?self.media.absAvailable():false};this.mbsAvailable=function(){return self.media?self.media.mbsAvailable():false};this.fullscreen=function(value){if(state.mobileAutoplay&&Spieler.userInteraction){unblockPlaysinlineState()}log("fullscreen requested: ",value);var entering=value===true||value===undefined&&(!Spieler.browser.fs.isFullscreenElement(elements.main)||nfm&&!nfm.inFullscreen());if(entering){if(Spieler.browser.fs[config.nativeFullscreen?"native":"html5"]===true){if(Spieler.userInteraction===false){error("going fullscreen requires user interaction");dispatcher.dispatch(Spieler.events.FULLSCREENERROR)}else{dispatcher.dispatch(Spieler.events.FULLSCREEN,{enter:true,exit:false,toggle:false})}}else{error("going fullscreen is not available for spieler in this context");dispatcher.dispatch(Spieler.events.FULLSCREENERROR)}}else{dispatcher.dispatch(Spieler.events.FULLSCREEN,{enter:false,exit:true,toggle:false})}};this.playing=function(){return state.playing};this.upid=function(){return upid};this.destroy=function(){dispatcher.dispatch(Spieler.events.DESTROY);removeEventListeners();if(screen&&!screen.isDestroyed()){screen.destroy();screen=null}if(dispatcher){dispatcher.destroy()}element.innerHTML="";delete instances[upid]};this.isFlashEnabled=function(){return!config.denyFlash&&Spieler.browser.has.flash()};this.changePassiveState=function(newState){if(newState!==state.passive){state.passive=newState;log('Passive state changed to "'+(newState?"passive":"active")+'"');dispatcher.dispatch(Spieler.events.PASSIVESTATECHANGED,state.passive)}};this.laterUpdateConfig=function(configValue,initState){Spieler.plugins.dfp.laterUpdateConfig={};Spieler.plugins.dfp.laterUpdateConfig.configValue=configValue;Spieler.plugins.dfp.laterUpdateConfig.initState=initState};this.getPassiveState=function(){return state.passive};this.playbackRate=function(value){if(value!==undefined&&state.pRate!=value){if(screen&&!screen.isDestroyed()&&self.media.playbackRateChangable()){screen.playbackRate(value)}state.pRate=value}return state.pRate};dispatcher.add(Media.events.PLATFORMCHANGE,onMediaPlatformChange);if(Spieler.browser.is.smartphone&&!Spieler.browser.is.iOS){dispatcher.add(Spieler.events.VOLUMECHANGE,function(eventName,value){if(value>0&&state.muted){self.muted(false)}})}dispatcher.add(Spieler.events.END,function(){hooks.exec("post-clip",{resources:self.media},function(err){if(err){error("post-clip hook failed.",err);return}dispatcher.dispatch(Spieler.events.POSTCLIPDONE)});state.playing=false;state.playState="stopped"});dispatcher.add(Spieler.events.PAUSED,function(){state.playState="paused";if(state.mobileAutoplay&&Spieler.userInteraction){if(Spieler.browser.is.iOS>=10){state.newIosDelayedUnblock=true}else{unblockPlaysinlineState()}}});dispatcher.add(Spieler.events.PLAYING,function(){state.posterClicked=true;hidePoster();state.playState="playing"});dispatcher.add(Spieler.events.POSTCLIPDONE,function(eventName){if(config.nativeControls||config.basicUi){state.posterClicked=false}if(config.poster&&config.showPosterAtVideoEnd){showPoster();elements.video.load();dispatcher.dispatch(Spieler.events.PAUSE)}state.finishedPlayback=true;state.playState="stopped";state.playing=false;if(screen&&!screen.isDestroyed()&&!config.nativeControls){screen.destroy(eventName)}});dispatcher.add(Spieler.events.PLAY,function(eventName,data){state.playing=true;if(state.newIosDelayedUnblock||state.mobileAutoplay&&Spieler.userInteraction){state.newIosDelayedUnblock=undefined;unblockPlaysinlineState()}if(data&&data.feedback){if(!state.posterClicked){if(config.nativeControls){reinit()}}else{state.playState="playing"}}});dispatcher.add(Spieler.events.PAUSE,function(){if(!state.poking){state.playing=false}});dispatcher.add(Spieler.events.ERROR,function(e,data){if(self.media.sources.length>0){log("error loading media, trying next format. Data:",data);if(self.media.qualities()>1){self.quality(self.quality()+1)}else{self.media.sources.shift();loadMedia(self.media.sources)}}});dispatcher.add(Spieler.events.GETSIZE,function(eventName,data){log("GETSIZE",data.width,data.height);if(config.autoSize){element.style.width=data.width+"px";element.style.height=data.height+"px"}benchmark.log("spieler","getSize");info("getSize "+benchmark.measure("spieler","screen","getSize")+"ms");if(screen instanceof FlashScreen){dom.addClass(elements.video,"hidden")}else if(screen instanceof TagScreen){if(dom.hasClass(elements.video,"hidden")){dom.removeClass(elements.video,"hidden")}}});dispatcher.add(Spieler.events.SCREENDESTROY,function(){if(screen&&screen.isDestroyed()){screen=null}});this.getHlsInstance=function(){return screen&&screen.getHlsInstance?screen.getHlsInstance():undefined};this.elements=elements;this._configOverrides={};this.dispatcher=dispatcher;
this.hooks=hooks;this.fullScreen=this.fullscreen;benchmark.start("spieler");if(state.playing&&Spieler.browser.is.smartphone){if(Spieler.browser.is.iOS>=10){if(state.muted){info("autoplay requirements have been met on this iOS device, adding playsinline attribute to video tag");state.mobileAutoplay=true}else{warn("autoplay is not supported without being `muted`, overriding config by removing muted and playing setting");state.playing=false;state.muted=false}}else if(Spieler.browser.is.android&&Spieler.browser.is.chrome>=53){if(state.muted){info("autoplay requirements have been met on this mobile device");state.mobileAutoplay=true}else{warn("autoplay is not supported without being `muted`, overriding config by removing muted and playing setting");state.playing=false;state.muted=false}}else{warn("autoplay is not supported on this device or browser, overriding config by removing muted and playing setting");state.playing=false;state.muted=false}}if(!element){throw new Error("missing container element")}if(typeof element==="string"){element=document.getElementById(element)}utils.extend(elements,initDOM(element,state));if(!config.hasOwnProperty("nativeFullscreen")||typeof config.nativeFullscreen==="undefined"){config.nativeFullscreen=Spieler.browser.fs.html5!==true}if(config.nativeFullscreen){nfm=new NativeFullscreenManager(elements.video,dispatcher,(!config.nativeControls))}if(config.nativeControls){ncm=new NativeControlsManager(elements.video,dispatcher);ncm.enable()}instances[upid]={instance:this,arguments:arguments};addEventListeners();initPlugins();createBasicUI();if(resources&&(config.nativeControls||config.basicUi)){state.posterClicked=false}if(config.poster&&!state.playing){showPoster()}if(resources&&state.playing){init(resources,finishConstructor)}else{finishConstructor()}if(!config.basicUi){dom.on(window.document,Spieler.browser.fs.changeEvent,function(){if(inHTML5FS&&!Spieler.browser.fs.isFullscreenElement(elements.view)){inHTML5FS=false;console.log("Spieler: HTML5 fullscreen left by native controls");dispatcher.dispatch(Spieler.events.FULLSCREEN,{feedback:true})}});dispatcher.add(Spieler.events.FULLSCREEN,function(event,data){if(!data.feedback&&data.enter&&(state.playing&&config.nativeControls||!config.nativeControls)){console.log("Spieler: Entering HTML5 fullscreen");inHTML5FS=data.toggle?!inHTML5FS:true;if(inHTML5FS)elements.view[Spieler.browser.fs.request]()}})}warnAboutFlashAndNative();Object.defineProperty(this,"_state",{get:function(){return JSON.parse(JSON.stringify(state))},set:DUMMY})};var mainCSS="";mainCSS=".ppMain,.ppView,.ppView video{width:100%;height:100%}.ppMain.ad-clickthrough .ppVideoClick,.ppView .backcover,.ppView .ppVideoClick.hidden{display:none}.ppMain{position:relative;background-color:#aaa}.ppUi{pointer-events:none}.ppUi.active{pointer-events:auto}.ppView{position:absolute;top:0;left:0;background-color:#000}.ppView video{position:absolute}.ppView video.hidden,.ppView video.seek-hidden{width:1px;height:1px;position:absolute;z-index:-1}.ppView video:full-screen,body.ie8 .ppMain{width:100%;height:100%}.ppView video:-webkit-full-screen{width:100%;height:100%}.ppView video:-moz-full-screen{width:100%;height:100%}.ppView video:-ms-full-screen{width:100%;height:100%}.ppView video:-o-full-screen{width:100%;height:100%}.ppView .backcover,.ppView .ppVideoClick{position:absolute;top:0;left:0;bottom:0;right:0}.ppView .ppVideoClick{cursor:pointer;z-index:10}.ppView pre{color:red}.ppMain.ad-clickthrough{cursor:pointer}.ppMain .ppAdContainer{position:absolute;top:0;right:0;left:0;bottom:0}.ppMain .ppAdContainer.hidden{display:block!important;visibility:visible!important;z-index:-1000}.ppMain.ad-clickthrough .ppUi{pointer-events:none!important}.ppMain.ad-flash .ppView .backcover{display:block;background:#000}.ppMain.overlay .ppView .ppVideoClick{bottom:100px}.ppMain.nativeOverlay .ppView .ppAdContainer{top:100px;bottom:100px}.ppMain.nativeOverlayHidden .ppView .ppAdContainer{top:0;bottom:0}.ppAdContainer{background:0 0!important}.ppMain.flashblockdetector .fbd-swf{position:absolute;left:0;right:0;z-index:2;width:100%;height:100%}.ppMain.flashblockdetector .fbd-swf.hidden{visibility:hidden;display:block!important}.ppMain.backgroundHack.ad-clickthrough .ppUi{background-color:rgba(0,0,0,0)}body .ppMain ::-webkit-media-controls-play-button{display:none!important}body .ppMain ::-webkit-media-controls-start-playback-button{display:none!important}body .ppMain.nativeControls:not(.basicUi) ::-webkit-media-controls-play-button{display:initial!important}body .ppMain.nativeControls:not(.basicUi) ::-webkit-media-controls-start-playback-button{display:initial!important}";var buildNumber="Debug";buildNumber="1.39.0 - Lajos Meszaros.master.4460978b0a0";var path="/";var script=document.querySelector('script[src*="spieler.js"]');if(script!==null){var index=script.src.indexOf("spieler.js");path=script.src.substr(0,index);path=path.substr(0,path.lastIndexOf("/")+1);var pathWithoutProtocol=path.split("//")[1];if(pathWithoutProtocol.indexOf("/")==pathWithoutProtocol.lastIndexOf("/")){path+="spieler/"}}var events={READY:"READY",PLAY:"PLAY",PLAYING:"PLAYING",PAUSE:"PAUSE",PAUSED:"PAUSED",END:"END",ALMOSTENDED:"ALMOSTENDED",FULLSCREEN:"FULLSCREEN",FULLSCREENERROR:"FULLSCREENERROR",GETSIZE:"GETSIZE",TIMEUPDATE:"TIMEUPDATE",ERROR:"ERROR",DURATIONCHANGE:"DURATIONCHANGE",QUALITY:"QUALITY",UNSUPPORTEDFORMAT:"UNSUPPORTEDFORMAT",VOLUMECHANGE:"VOLUMECHANGE",MUTEDCHANGE:"MUTEDCHANGE",DESTROY:"DESTROY",MEDIACHANGE:"MEDIACHANGE",SCREENDESTROY:"SCREENDESTROY",PASSIVESTATECHANGED:"PASSIVESTATECHANGED",OFFLINE:"OFFLINE",POSTCLIPDONE:"POSTCLIPDONE",THROTTLE:"THROTTLE"};Spieler.events=events;Spieler.flash={dispatch:function(upid,event,data){if(instances[upid]){instances[upid].instance.dispatcher.dispatch(event,data)}}};Spieler.buildNumber=buildNumber;Spieler.path=path;Spieler.browser=new Browser;Spieler.plugins={};if(Spieler.browser.is.smartphone&&!Spieler.browser.is.firefox){Spieler.userInteraction=false;var uiTimeout=null;dom.on(window,"touchstart",function(){benchmark.log("spieler","touchstart");Spieler.userInteraction=true;if(uiTimeout!==null){clearTimeout(uiTimeout)}uiTimeout=setTimeout(function(){Spieler.userInteraction=false;uiTimeout=null},1e3)},true)}else{Spieler.userInteraction=null}window.Spieler=Spieler})(window);(function(){"use strict";var TIMEOUT=2e3;var TEST_URL="//s0.2mdn.net/instream/video/client.js";var TEST_ELEMENT;var result=null;var timeout;var log;var events;function dispatchResult(dispatcher,newResult){result=newResult;if(result){log("Adblocker detected.");dispatcher.dispatch(events.HASADBLOCK)}else{log("No adblocker detected.");dispatcher.dispatch(events.NOADBLOCK)}dispatcher.dispatch(events.ADBLOCK,result)}function probe(callback){log("trying to load the test js");timeout=setTimeout(function(){log("test js couldn't load in "+TIMEOUT+"ms, assuming it's adblocked");callback(true)},TIMEOUT);TEST_ELEMENT=dom.addScript(TEST_URL,function(){log("test js loaded, there is no adblock");resetTimer();callback(false)},function(){log("test js didn't load, probably there is adblock");resetTimer();callback(true)})}function resetTimer(){if(timeout){clearTimeout(timeout);timeout=0}}function callProbe(spieler){if(!timeout){TEST_ELEMENT=null;probe(dispatchResult.bind(null,spieler.dispatcher))}}Spieler.plugins.adBlockDetector=function(spieler,elements,config){log=console.log.bind(console,"Spieler AdBlockDetector:");if(config){spieler.hooks.add("pre-init",function(data,callback){data.configOverrides.isAdblockDetectorEnabled=true;log("delaying playback until we have a result");spieler.dispatcher.addOnce(events.ADBLOCK,function(eventName,resultOfABD){data.configOverrides.isAdBlockerDetected=resultOfABD;callback(null,data)});callProbe(spieler)},"adblockdetector",true);callProbe(spieler)}};events=Spieler.plugins.adBlockDetector.events={ADBLOCK:"ADBLOCKDETECTOR.ADBLOCK",HASADBLOCK:"ADBLOCKDETECTOR.HASADBLOCK",NOADBLOCK:"ADBLOCKDETECTOR.NOADBLOCK"};Object.defineProperty(Spieler.plugins.adBlockDetector,"result",{get:function(){return result},set:DUMMY})})();"use strict";function AdBuffer(){var buffer={ads:[],index:0,typeDescriptor:[]};var podNumbers={preroll:0,sting:0,midroll:0,postroll:0,overlay:0};function flatten(collapsed){return collapsed.map(function(kvPair){var amount=kvPair[1];var value=kvPair[0];return Array(amount).fill(value)}).reduce(sumArray,[])}function isString(x){return typeof x==="string"}function wrapToArray(x){return Array.isArray(x)?Object.assign([],x):isString(x)?[x]:[]}function zip(a,b){return a.map(function(aValue,index){return[aValue,b[index]]})}function nth(n){return function(arr){return arr[n]}}this.getCurrentAdType=function(){return buffer.typeDescriptor[buffer.index-1]};this.getUpcomingAdType=function(){return buffer.index<buffer.typeDescriptor.length?buffer.typeDescriptor[buffer.index]:null};this.loadNextFromBuffer=function(){buffer.index++;return buffer.ads.shift()};this.set=function(adTags,adTypeDescriptor){var ads=wrapToArray(adTags);var explicitDescriptor=isString(adTypeDescriptor)?[[adTypeDescriptor,ads.length]]:adTypeDescriptor;var typeDescriptor=flatten(explicitDescriptor);if(typeDescriptor.length!==ads.length){console.error("AdBuffer [set]: adTypeDescriptor's length does not match with adTags");return}var pairs=zip(ads,typeDescriptor);var filteredPairs=pairs.filter(function(pair){return pair[0].trim()!==""});buffer.ads=filteredPairs.map(nth(0));buffer.typeDescriptor=filteredPairs.map(nth(1));buffer.index=0};this.getPodNumber=function(){var adType=this.getCurrentAdType();podNumbers[adType]++;return podNumbers[adType]};this.isEmpty=function(){return buffer.ads.length===0};this.didTypeChange=function(){return buffer.index>1?this.getCurrentAdType()!==buffer.typeDescriptor[buffer.index-2]:true};this.getBuffer=function(){return buffer}}(function(){"use strict";function URItoJSON(uri){return uri.split("&").map(function(pair){return pair.split("=")}).reduce(function(acc,kvPair){acc[kvPair[0]]=kvPair[1];return acc},{})}function JSONtoURI(json){return Object.entries(json).map(function(kvPair){return kvPair.join("=")}).join("&")}function wrapPropertyInArray(what,property){what[property]=[what[property]];return what}var LOG_PREFIX="Spieler DFP:";var IMA_SDK_URL={normal:"//imasdk.googleapis.com/js/sdkloader/ima3.js",debug:"//imasdk.googleapis.com/js/sdkloader/ima3_debug.js"};var DEBUG_LOCALSTORAGE_KEY="Spieler.DFP.debugConfig";var IMA_SDK_LOADED;var IMA_SDK_LOADED_TYPE;var IMA_SDK_ELEMENT;var GPT_URL="//www.googletagservices.com/tag/js/gpt.js";var googletag;var adSkinUnit;var adSkinContainer;var skinSlot=null;var log=function(){};var info=function(){};var error=function(){};var warn=function(){};function loadImaSdk(debug,callback){debug=!!debug;if(typeof callback!=="function"){callback=DUMMY}if(!IMA_SDK_LOADED||IMA_SDK_LOADED&&IMA_SDK_LOADED_TYPE!==(debug?"debug":"normal")){if(!!IMA_SDK_ELEMENT){log("IMA SDK is already loaded, but requested is of different type: "+IMA_SDK_LOADED_TYPE+" -> "+(debug?"debug":"normal"));dom.removeFromHead(IMA_SDK_ELEMENT)}else{log("IMA SDK is not loaded, trying to load it.")}IMA_SDK_ELEMENT=dom.addScript(IMA_SDK_URL[debug?"debug":"normal"],function(){log("loaded ima sdk");IMA_SDK_LOADED=true;IMA_SDK_LOADED_TYPE=debug?"debug":"normal";callback(IMA_SDK_LOADED)},function(){error("failed to load ima sdk");IMA_SDK_LOADED=false;dom.removeFromHead(IMA_SDK_ELEMENT);IMA_SDK_ELEMENT=undefined;callback(IMA_SDK_LOADED)})}else{log("IMA SDK is already loaded");callback(!!IMA_SDK_LOADED)}}loadImaSdk();var Dfp=function(spieler,elements,initialConfig){var state=new Scope;state.$register("sdkLoaded",undefined);state.$register("pluginInited",false);state.useFlash=null;state.adBlockDetected=false;state.companionAd=false;state.current={hook:{data:null,callback:null},position:null};state.playing="paused";state.playingVideoAds=true;state.loadingAd=false;state.adDisplayContainerInited=false;state.eventsAdded=false;state.beforePreInit=true;state.autoplay=elements.video.getAttribute("autoplay")!==null;var backup={media:null,currentTime:null};var defaultConfig={preroll:[],sting:[],midroll:[],postroll:[],overlay:[]};var config={};var videoAdPositions=[Dfp.positions.preroll,Dfp.positions.sting,Dfp.positions.midroll,Dfp.positions.postroll];var videoContent=elements.video;var adContainer=createAdContainer(elements.view);var lastAdWidth;var lastAdHeight;var resizeInterval;var buffer=new AdBuffer;var sdkWrapper;var onPlayCalled=false;var onPauseCalled=false;var onAdPausedCalled=false;var onAdResumedCalled=false;var spielerHandlers={mediaChange:function(){if(sdkWrapper){sdkWrapper.destroyAdsManager()}},play:function(){if(!state.adBlockDetected){if(onAdResumedCalled){onAdResumedCalled=false}else{onPlayCalled=true;sdkWrapper.resume();state.playing="playing";spieler.dispatcher.dispatch(Spieler.events.PLAYING)}}},pause:function(){if(!state.adBlockDetected){if(onAdPausedCalled){onAdPausedCalled=false}else{onPauseCalled=true;sdkWrapper.pause();state.playing="paused";showUI();spieler.dispatcher.dispatch(Spieler.events.PAUSED)}}},volumeChange:function(){if(!state.adBlockDetected){syncAdVolumeWithSpieler()}},mutedChange:function(){if(!state.adBlockDetected){syncAdVolumeWithSpieler()}},fullscreenChange:function(eventName,data){if(!state.adBlockDetected){log("onFullscreenChange",data);if(data.enter){clearInterval(resizeInterval);var r=1;sdkWrapper.resize(screen.width*r,screen.height*r,google.ima.ViewMode.FULLSCREEN)}else{sdkWrapper.resize(adContainer.offsetWidth,adContainer.offsetHeight,google.ima.ViewMode.NORMAL);restartResizeInterval()}}}};state.overlay=false;function Overlay(spieler){var overlayTimer;var self=this;function isNativeControls(){return spieler.elements.video.hasAttribute("controls")}function canRequestAd(){return!Spieler.browser.is.iOS}this.resetTimer=function(){clearTimeout(overlayTimer)};this.remove=function(){if(isNativeControls()){addClassToMain("nativeOverlayHidden");removeClassFromMain("nativeOverlay")}else{removeClassFromMain("overlay")}};this.show=function(){if(isNativeControls()){removeClassFromMain("nativeOverlayHidden");addClassToMain("nativeOverlay")}else{addClassToMain("overlay")}};this.stop=function(){self.resetTimer();sdkWrapper.stop();sdkWrapper.destroyAdsManager(true);state.overlay=false;self.remove();adContainer.style.bottom=0};this.handle=function(config){self.resetTimer();var ad=config.overlay;if(ad){if(state.overlay){sdkWrapper.stop()}if(canRequestAd()){state.overlay=true;requestAds(ad,"overlay");sdkWrapper.addEventListener("error",function(){self.remove();state.overlay=false})}}else if(state.overlay){state.overlay=false;sdkWrapper.stop();sdkWrapper.destroyAdsManager();self.remove()}};this.prepare=function(){var ad=config.overlay;if(!state.adBlockDetected){self.resetTimer();overlayTimer=setTimeout(function(){if(ad&&canRequestAd()){state.overlay=true;adContainer.style.bottom=config.overlayBottom+"px";requestAds(ad,"overlay")}},3e3)}};this.bindToSpieler=function(){spieler.dispatcher.add(Spieler.events.GETSIZE,function(eventName,data){if(!state.adBlockDetected&&!isVideoAdBeingPlayed()&&!state.overlay){self.prepare()}});spieler.dispatcher.add(Spieler.events.FULLSCREEN,function(eventName,data){var ad=config.overlay;if(ad&&state.overlay){sdkWrapper.stop();if(canRequestAd()){if(data.enter){requestAds(ad,"overlay",{nonLinearWidth:screen.width,nonLinearHeight:screen.height})}else{requestAds(ad,"overlay")}}}});spieler.dispatcher.add(Spieler.events.MEDIACHANGE,function(){state.beforePreInit=true;if(state.overlay){self.stop()}else{self.resetTimer()}});spieler.dispatcher.add(Spieler.events.END,function(){self.stop()})}}var overlay=new Overlay(spieler);var addClassToMain=dom.addClass.bind(dom,elements.main);var removeClassFromMain=dom.removeClass.bind(dom,elements.main);function hideUI(){if(!state.overlay){["ad-clickthrough"].concat(state.useFlash?["ad-flash"]:[]).forEach(function(className){addClassToMain(className)})}else{overlay.show()}}function showUI(){["ad-clickthrough","ad-flash"].forEach(function(className){removeClassFromMain(className)})}function isValidAdDefinition(param){return typeof param==="string"||Array.isArray(param)&&param.length}function canPlayNextAd(){return!buffer.isEmpty()&&state.playingVideoAds}function getDebugConfig(){var debugConfig={};if(isLocalStorageSupported&&!!localStorage.getItem(DEBUG_LOCALSTORAGE_KEY)){try{debugConfig=JSON.parse(localStorage.getItem(DEBUG_LOCALSTORAGE_KEY));log("Configuration read from localStorage")}catch(e){warn("Invalid configuration found for "+DEBUG_LOCALSTORAGE_KEY+", configuration was not loaded")}}return debugConfig}function updateConfig(newConfig,initCall){config=transformAdsToAdArrays(utils.extend({},defaultConfig,config,newConfig,getDebugConfig()));if(!initCall&&!isVideoAdBeingPlayed()&&!state.beforePreInit){overlay.handle(config)}adContainer.style.bottom=state.overlay?config.overlayBottom+"px":0;if(config.skin){if(!googletag){loadGPT(onGPTLoaded)}else{handleSkinSlotUpdate()}}}function transformAdsToAdArrays(rawConfig){return Object.keys(Dfp.positions).filter(and(isPropOf(rawConfig),not(compose(Array.isArray,propOf(rawConfig))))).reduce(wrapPropertyInArray,rawConfig)}function applyCustomParameters(adTag,params){var patchedAdTag;var custParams;adTag=adTag||"";var parts=adTag.match(/^(.*?)(&cust_params=|cust_params=)([^&]*)(.*)$/);if(parts!==null){patchedAdTag=parts[1]+parts[4];custParams=URItoJSON(decodeURIComponent(parts[3]))}else{patchedAdTag=adTag.slice(0);custParams={}}custParams=Object.assign({},custParams,params);return patchedAdTag+"&cust_params="+encodeURIComponent(JSONtoURI(custParams))}function getSpielerHandlers(){return[[Spieler.events.PLAY,"play"],[Spieler.events.PAUSE,"pause"],[Spieler.events.VOLUMECHANGE,"volumeChange"],[Spieler.events.MUTEDCHANGE,"mutedChange"],[Spieler.events.MEDIACHANGE,"mediaChange"],[Spieler.events.FULLSCREEN,"fullscreenChange"]]}function addSpielerListeners(){getSpielerHandlers().forEach(function(kvPair){var eventName=kvPair[0];var handler=spielerHandlers[kvPair[1]];spieler.dispatcher.add(eventName,handler)})}function removeSpielerListeners(){getSpielerHandlers().forEach(function(kvPair){var eventName=kvPair[0];var handler=spielerHandlers[kvPair[1]];spieler.dispatcher.remove(eventName,handler)})}function isVideoAdBeingPlayed(){return videoAdPositions.indexOf(state.current.position)!==-1}function onLoadImaSdk(success){var isBlocked=!success;if(!isBlocked&&!state.pluginInited){initPlugin(elements);state.pluginInited=true}if(!isBlocked&&!state.sdkLoaded){state.sdkLoaded=true;spieler.dispatcher.dispatch(Dfp.events.READY,{position:state.current.position});if(!state.eventsAdded){overlay.bindToSpieler();state.eventsAdded=true}}}function waitForSdkToLoad(callback){state.$unwatch("sdkLoaded",waitForSdkToLoadCallback.bind(this,callback));state.$watch("sdkLoaded",waitForSdkToLoadCallback.bind(this,callback))}function waitForSdkToLoadCallback(callback,value){if(value!==undefined){callback(state.adBlockDetected)}}function waitForPluginInit(callback){state.$watch("pluginInited",function(value){if(value){callback()}})}function isFlashAllowed(data){return!(data&&data.configOverrides&&data.configOverrides.denyFlash||spieler._configOverrides.denyFlash)&&Spieler.browser.has.flash()}function triggerMidroll(midroll){var ad=midroll?JSON.parse(JSON.stringify(midroll)):config.midroll;if(spieler.media){if(isValidAdDefinition(ad)){handleMidroll(ad)}else{info("skipping midroll, because there is no valid midroll defined in the config or in the given parameters")}}else{info("skipping midroll, because there is no content being played")}}function stop(){if(isVideoAdBeingPlayed()){sdkWrapper.stop();restoreSpieler()}else{error("stop() was called, but there is no advertisement is in progress")}}function resume(){sdkWrapper.resume();hideUI()}function getPublicAPI(isBlocked){return{triggerMidroll:isBlocked?DUMMY:triggerMidroll,stop:isBlocked?DUMMY:stop,resume:isBlocked?DUMMY:resume,getCurrentPosition:function(){log("getCurrentPosition: isBlocked: "+isBlocked);return isBlocked?null:state.current.position},getDfpTimeAndDuration:function(){return{time:sdkWrapper.getRemainingTime(),duration:sdkWrapper.getDuration()}},updateConfig:updateConfig,isVideoAdBeingPlayed:isVideoAdBeingPlayed}}function createAdContainer(parent){var element=dom.createElement("div",{"class":"ppAdContainer hidden"});parent.appendChild(element);return element}function initPlugin(elements){var locale=config.locale&&typeof config.locale==="string"?config.locale.slice(0,2):(window.navigator.language||window.navigator.browserLanguage).split("-")[0];sdkWrapper=new SdkWrapper(locale);sdkWrapper.addEventListener("loaded-pre",function(){benchmark.log("ad_"+buffer.getCurrentAdType(),"loaded-pre","google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED event was fired by the adsManager, vast/vpaid information is ready");state.loadingAd=false;spieler.dispatcher.dispatch(Dfp.events.LOAD,{position:state.current.position});spieler.dispatcher.dispatch(Spieler.events.GETSIZE,{width:adContainer.offsetWidth,height:adContainer.offsetHeight});hideUI();dom.show(adContainer)});sdkWrapper.addEventListener("loaded-post",function(e){sdkWrapper.setVolume(spieler.muted()?0:spieler.volume());if(e.detail.createdAdsManager){startAds();onAdResumedCalled=true;onPlayCalled=false}if(!state.overlay){spieler.dispatcher.dispatch(Spieler.events.PLAY,{feedback:true});spieler.dispatcher.dispatch(Spieler.events.PLAYING);addSpielerListeners()}});sdkWrapper.addEventListener("adLoaded",function(e){spieler.dispatcher.dispatch(Dfp.events.AD_LOADED,{advertiserName:e.detail.ad.getAdvertiserName(),creativeAdId:e.detail.ad.getCreativeAdId(),adId:e.detail.ad.getAdId()})});function handleNextAd(){if(state.loadingAd){info("ignoring handleNextAd(), I'm already loading an ad");return}if(canPlayNextAd()){requestNextAd()}else if(state.playingVideoAds&&buffer.isEmpty()){state.playingVideoAds=false;sdkWrapper.destroyAdsManager(true);showUI();dom.hide(adContainer);spieler.changePassiveState(false);removeSpielerListeners();spieler.dispatcher.dispatch(Dfp.events.END,{position:state.current.position,currentPosition:buffer.getUpcomingAdType()});state.current.position=null;if(state.current.hook.callback){state.current.hook.callback(null,state.current.hook.data);state.current.hook.callback=null}}if(state.companionAd){state.companionAd=false;var div=document.getElementById(config.companionParameters.container);div.innerHTML=""}}sdkWrapper.addEventListener("error",function(e){benchmark.finish("ad_"+buffer.getCurrentAdType(),"error",e.detail.adErrorEvent.type);state.loadingAd=false;var data={adErrorEvent:e.detail.adErrorEvent,currentAd:e.detail.currentAd||undefined,position:state.current.position,currentPosition:buffer.getUpcomingAdType()};var err=data.adErrorEvent.getError();var userRequestContext=e.detail.userRequestContext;var currentAd=data.currentAd;var errorCode=err.getErrorCode();if(!Dfp.ignoredErrorsGA.some(function(el){return el===errorCode})){Analytics.event("spieler","dfp_error",window.location.host+window.location.pathname,{dimension1:err.getErrorCode(),dimension2:err.getInnerError(),dimension3:err.getMessage(),dimension4:userRequestContext.adsRequest.adTagUrl,dimension5:userRequestContext.adsRequest.location,dimension6:userRequestContext.adsRequest.referrer,dimension7:currentAd&&currentAd.getTitle(),dimension8:currentAd&&currentAd.getDescription(),dimension9:currentAd&&currentAd.getMediaUrl(),dimension10:currentAd&&currentAd.getCreativeAdId(),dimension11:currentAd&&currentAd.getCreativeId(),dimension12:currentAd&&currentAd.getContentType(),dimension13:currentAd&&currentAd.getDealId(),dimension14:currentAd&&currentAd.getVastMediaWidth(),dimension15:currentAd&&currentAd.getVastMediaHeight(),dimension16:currentAd&&currentAd.getHeight(),dimension17:currentAd&&currentAd.getWidth(),dimension18:currentAd&&currentAd.getWrapperAdIds(),dimension19:currentAd&&currentAd.getWrapperAdSystems(),dimension20:currentAd&&currentAd.getWrapperCreativeIds(),dimension21:currentAd&&currentAd.getUniversalAdIdRegistry(),dimension22:currentAd&&currentAd.getUniversalAdIdValue()})}spieler.dispatcher.dispatch(Dfp.events.ERROR,data);handleNextAd()});sdkWrapper.addEventListener("ended",function(){handleNextAd()});sdkWrapper.addEventListener("started",function(e){benchmark.log("ad_"+buffer.getCurrentAdType(),"started",e.detail.adEvent.type+" event was fired by the adsManager, ad is playing");sdkWrapper.setVolume(spieler.muted()?0:spieler.volume());state.playing="playing";if(config.companionParameters!==undefined){var adEvent=e.detail.adEvent;startCompanionAd(adEvent)}spieler.dispatcher.dispatch(Dfp.events.STARTED,{position:state.current.position})});sdkWrapper.addEventListener("firstQuartile",function(){benchmark.finish("ad_"+buffer.getCurrentAdType(),"firstQuartile");spieler.dispatcher.dispatch(Dfp.events.FIRST_QUARTILE,{position:state.current.position})});sdkWrapper.addEventListener("midpoint",function(){benchmark.finish("ad_"+buffer.getCurrentAdType(),"midpoint");spieler.dispatcher.dispatch(Dfp.events.MIDPOINT,{position:state.current.position})});sdkWrapper.addEventListener("thirdQuartile",function(){benchmark.finish("ad_"+buffer.getCurrentAdType(),"thirdQuartile");spieler.dispatcher.dispatch(Dfp.events.THIRD_QUARTILE,{position:state.current.position})});sdkWrapper.addEventListener("stopped",function(){benchmark.finish("ad_"+buffer.getCurrentAdType(),"stopped");spieler.dispatcher.dispatch(Dfp.events.STOPPED,{position:state.current.position})});sdkWrapper.addEventListener("skipped",function(){benchmark.finish("ad_"+buffer.getCurrentAdType(),"skipped");spieler.dispatcher.dispatch(Dfp.events.SKIPPED,{position:state.current.position})});sdkWrapper.addEventListener("paused",function(){benchmark.finish("ad_"+buffer.getCurrentAdType(),"paused");spieler.dispatcher.dispatch(Dfp.events.PAUSED,{position:state.current.position});if(onPauseCalled){onPauseCalled=false}else{onAdPausedCalled=true;spieler.dispatcher.dispatch(Spieler.events.PAUSE,{feedback:true});spieler.dispatcher.dispatch(Spieler.events.PAUSED)}});sdkWrapper.addEventListener("playing",function(){state.playing="playing";hideUI();spieler.dispatcher.dispatch(Dfp.events.RESUMED,{position:state.current.position});if(onPlayCalled){onPlayCalled=false}else{onAdResumedCalled=true;spieler.dispatcher.dispatch(Spieler.events.PLAY,{feedback:true});spieler.dispatcher.dispatch(Spieler.events.PLAYING)}});sdkWrapper.addEventListener("volume-changed",function(){var adVolume=sdkWrapper.getVolume();if(adVolume!==0&&spieler.volume()!==adVolume){log("setting framework volume to",adVolume);spieler.volume(adVolume)}spieler.dispatcher.dispatch(Dfp.events.VOLUME_CHANGED,{position:state.current.position,volume:adVolume})});sdkWrapper.addEventListener("muted",function(){if(!spieler.muted()){log("setting framework muted to true");spieler.muted(true)}});sdkWrapper.addEventListener("clicked",function(){if(state.playing==="playing"){onPauseCalled=false;sdkWrapper.pause();showUI()}else if(elements.main.className.search("basicUi")>0){sdkWrapper.resume();hideUI()}});sdkWrapper.createAdDisplayContainer(adContainer,videoContent);sdkWrapper.createAdsLoader()}function requestAds(adTags,adTypeDescriptor,options){buffer.set(adTags,adTypeDescriptor);if(canPlayNextAd()||buffer.getUpcomingAdType()==="overlay"){requestNextAd(options)}else{sdkWrapper.dispatchEvent(new CustomEvent("ended"))}}function requestNextAd(options){info("requestNextAd");var nextAd=buffer.loadNextFromBuffer();if(!nextAd){error("failed to request next ad, buffer is empty");return}var podNumber=buffer.getPodNumber();if(buffer.didTypeChange()){if(Dfp.positions[buffer.getCurrentAdType()]!==undefined){state.current.position=Dfp.positions[buffer.getCurrentAdType()]}}var customParams=utils.extend({pod:podNumber},config.parameters);var adTag=(Object.getOwnPropertyNames(customParams).length>1?applyCustomParameters(nextAd,customParams):nextAd)+"&pod="+podNumber;if(config.companionParameters&&config.companionParameters.companion_width&&config.companionParameters.companion_height){adTag+="&ciu_szs="+config.companionParameters.companion_width+"x"+config.companionParameters.companion_height}log("adTag:",adTag);state.loadingAd=true;sdkWrapper.requestAd(adTag,options);benchmark.start("ad_"+buffer.getCurrentAdType(),"requestAds","adsLoader.requestAds() called")}function onVideoContentMetaData(){videoContent.removeEventListener("loadedmetadata",onVideoContentMetaData);benchmark.log("dfp","loadedmetadata","dummyvideo.mp4 metadata loaded");sdkWrapper.setContentInitialized(true);startAds()}function initOnce(data){videoContent.src=Spieler.path+"assets/dummyvideo.mp4";benchmark.log("dfp","assigned dummyvideo.mp4 to video element");videoContent.addEventListener("loadedmetadata",onVideoContentMetaData);videoContent.load();if(data.resources.metadata&&data.resources.metadata.dfp){config=data.resources.metadata.dfp}}function loadGPT(callback){googletag=dom.addScript(GPT_URL,function(){log("loaded GPT");callback(true)},function(){error("failed to load GPT")})}function onGPTLoaded(success){if(success){googletag=window.googletag||{};googletag.cmd=googletag.cmd||[];gptCallback(onGPTCallback)}}function onGPTCallback(){handleAdSlot(config.skin.container,config.skin.adUnit)}function handleAdSlot(divOnTheVideoProduct,adUnitOnTheVideoProduct){adSkinUnit=adUnitOnTheVideoProduct;adSkinContainer=divOnTheVideoProduct;googletag.cmd.push(function(){skinSlot=prepareSkinSlot(adSkinUnit,adSkinContainer);googletag.enableServices();googletag.display(adSkinContainer)});googletag.pubads().addEventListener("slotRenderEnded",function(event){spieler.dispatcher.dispatch(Dfp.events.SPONSORSHIPSKINLOADED)})}function prepareSkinSlot(adSkinUnit,adSkinContainer){var slot=googletag.defineOutOfPageSlot(adSkinUnit,adSkinContainer).addService(googletag.pubads());Object.keys(config.parameters).forEach(function(key){slot.setTargeting(key,config.parameters[key])});return slot}function handleSkinSlotUpdate(){if(googletag&&config.skin&&config.skin.container&&config.skin.adUnit&&(config.skin.container!==adSkinContainer||config.skin.adUnit!==adSkinUnit)){adSkinContainer=config.skin.container;adSkinUnit=config.skin.adUnit;googletag.destroySlots([skinSlot]);skinSlot=prepareSkinSlot(adSkinUnit,adSkinContainer);displaySlot()}}function gptCallback(callback){googletag.cmd.push(callback)}function handlePreInit(data,callback){benchmark.log("dfp","handlePreInit");waitForPluginInit(function(){benchmark.log("dfp","plugin finished initializing");log("executing pre-init hook with data:",data);if(Spieler.plugins.dfp.laterUpdateConfig){updateConfig(Spieler.plugins.dfp.laterUpdateConfig.configValue,Spieler.plugins.dfp.laterUpdateConfig.initState);Spieler.plugins.dfp.laterUpdateConfig=null}state.beforePreInit=false;var ad=config.preroll.concat(config.sting);setPluginState(data,callback,Dfp.positions.preroll);if(!state.adDisplayContainerInited){state.adDisplayContainerInited=true;sdkWrapper.initAdDisplayContainer()}patchConfig();requestAds(ad,[["preroll",config.preroll.length],["sting",config.sting.length]],{autoplay:state.autoplay});state.autoplay=false})}function handleMidroll(ad){waitForPluginInit(function(){log("executing midroll");overlay.stop();setPluginState(null,null,Dfp.positions.midroll);backupSpieler();var changed=false;var handleMediaChange=function(){log("media has been changed");changed=true;clearBackup();sdkWrapper.destroyAdsManager()};spieler.dispatcher.addOnce(Spieler.events.MEDIACHANGE,handleMediaChange);spieler.dispatcher.addOnce(Dfp.events.END,function(){spieler.dispatcher.remove(Spieler.events.MEDIACHANGE,handleMediaChange);log("resume after midroll");state.current.position=null;if(!changed){restoreSpieler()}});spieler.pause();patchConfig();requestAds(ad,"midroll")})}function handlePostClip(data,callback){waitForPluginInit(function(){log("executing post-clip hook with data:",data);var ad=config.postroll;setPluginState(data,callback,Dfp.positions.postroll);patchConfig();sdkWrapper.triggerContentComplete();requestAds(ad,"postroll");
})}function resetPluginState(){state.current.position=null;state.current.hook.callback=null;state.current.hook.data=null;spieler.changePassiveState(false)}function setPluginState(data,callback,position){state.useFlash=isFlashAllowed(data);state.playingVideoAds=true;state.current.hook.callback=callback;state.current.hook.data=data;state.current.position=position;spieler.changePassiveState(true)}function patchConfig(){if(!config.parameters){config.parameters={}}}function backupSpieler(){backup.media=spieler.media;backup.currentTime=spieler.currentTime()}function clearBackup(){backup.media=null;backup.currentTime=null}function restoreSpieler(){if(backup.media){spieler.play(backup.media.getOriginalResource(),true,true);backup.media=null;if(backup.currentTime){spieler.changePassiveState(false);spieler.dispatcher.addOnce(Spieler.events.DURATIONCHANGE,function(){spieler.currentTime(backup.currentTime);backup.currentTime=null;if(Spieler.browser.is.iPad||Spieler.browser.is.iPhone){spieler.resume()}})}else{backup.currentTime=null}}}function startAds(){lastAdWidth=adContainer.offsetWidth;lastAdHeight=adContainer.offsetHeight;if(sdkWrapper.startAds()){restartResizeInterval()}}function restartResizeInterval(){if(resizeInterval){clearInterval(resizeInterval)}resizeInterval=setInterval(function(){if(adContainer.offsetWidth!==lastAdWidth||adContainer.offsetHeight!==lastAdHeight){sdkWrapper.resize(adContainer.offsetWidth,adContainer.offsetHeight,google.ima.ViewMode.NORMAL);lastAdWidth=adContainer.offsetWidth;lastAdHeight=adContainer.offsetHeight}},200)}function startCompanionAd(e){var ad=e.getAd();var selectionCriteria=new google.ima.CompanionAdSelectionSettings;selectionCriteria.resourceType=config.companionParameters.resourceType===undefined?"ALL":config.companionParameters.resourceType;selectionCriteria.creativeType=config.companionParameters.creativeType===undefined?"ALL":config.companionParameters.creativeType;selectionCriteria.sizeCriteria=config.companionParameters.sizeCriteria===undefined?"SELECT_EXACT_MATCH":config.companionParameters.sizeCriteria;var companionWidth=config.companionParameters.companion_width;var companionHeight=config.companionParameters.companion_height;var companionAds=ad.getCompanionAds(companionWidth,companionHeight,selectionCriteria);if(companionAds&&companionAds.length){var companionAd=companionAds[0];var content=companionAd.getContent();var div=document.getElementById(config.companionParameters.container);div.innerHTML=content;state.companionAd=true}}function syncAdVolumeWithSpieler(){var spielerVolume=spieler.muted()?0:spieler.volume();var adVolume=sdkWrapper.getVolume();if(adVolume!==null&&adVolume!==spielerVolume){log("setting dfp volume to",spielerVolume);sdkWrapper.setVolume(spielerVolume)}}updateConfig(initialConfig,true);if(config){spieler.hooks.add("pre-init",function(data,callback){if(data.configOverrides.isAdblockDetectorEnabled){state.adBlockDetected=data.configOverrides.isAdBlockerDetected;spieler.dfp=getPublicAPI(state.adBlockDetected)}benchmark.start("dfp");waitForSdkToLoad(function(isBlocked){benchmark.log("dfp","ima sdk loaded","finished loading IMA SDK asyncronously");if(isBlocked){benchmark.finish("dfp");info("skipping pre-init hook, because of sdk being blocked");resetPluginState();callback()}else{if(sdkWrapper&&!sdkWrapper.isContentInitialized()){initOnce(data)}if(isValidAdDefinition(config.preroll)||isValidAdDefinition(config.sting)){handlePreInit(data,callback)}else{benchmark.finish("dfp");info("skipping pre-init hook, because there is no valid preroll or sting defined in the config");resetPluginState();callback()}}});if(data.configOverrides.isAdblockDetectorEnabled){if(!state.adBlockDetected){loadImaSdk(config.debug,onLoadImaSdk)}else{if(sdkWrapper){sdkWrapper.destroyAdsManager();overlay.resetTimer()}onLoadImaSdk(false);state.sdkLoaded=false}}else{loadImaSdk(config.debug,function(success){var isBlocked=!success;state.adBlockDetected=isBlocked;spieler.dfp=getPublicAPI(isBlocked);if(success){onLoadImaSdk(success)}else if(isBlocked&&sdkWrapper){sdkWrapper.destroyAdsManager();overlay.resetTimer()}})}},"dfp-preroll");spieler.hooks.add("post-clip",function(data,callback){state.sdkLoaded=undefined;if(state.adBlockDetected){info("skipping post-clip hook, because of sdk being blocked");resetPluginState();callback()}else{if(isValidAdDefinition(config.postroll)){handlePostClip(data,callback)}else{info("skipping post-clip hook, because there is no valid postroll defined in the config");resetPluginState();callback()}}},"dfp-postroll")}};Dfp.logsOn=function(){log=console.log.bind(console,LOG_PREFIX);info=console.info.bind(console,LOG_PREFIX);error=console.error.bind(console,LOG_PREFIX);warn=console.warn.bind(console,LOG_PREFIX);log("DFP logs enabled.")};Dfp.logsOff=function(){log=function(){};info=function(){};error=function(){};warn=function(){}};Dfp.positions={preroll:0,sting:1,overlay:2,midroll:50,postroll:100};Dfp.events={READY:"DFP.READY",ERROR:"DFP.ERROR",LOAD:"DFP.LOAD",AD_LOADED:"DFP.AD_LOADED",END:"DFP.END",RESUMED:"DFP.RESUMED",PAUSED:"DFP.PAUSED",STARTED:"DFP.STARTED",FIRST_QUARTILE:"DFP.FIRST_QUARTILE",MIDPOINT:"DFP.MIDPOINT",THIRD_QUARTILE:"DFP.THIRD_QUARTILE",STOPPED:"DFP.STOPPED",SKIPPED:"DFP.SKIPPED",VOLUME_CHANGED:"DFP.VOLUME_CHANGED",POSITION_CHANGED:"DFP.POSITION_CHANGED",SPONSORSHIPSKINLOADED:"DFP.SPONSORSHIPSKINLOADED"};Dfp.ignoredErrorsGA=[303];Spieler.plugins.dfp=Dfp})();(function(){"use strict";var P="Spieler FlashBlockDetector: ";var dispatcher=new Dispatcher;var result=null;var events;Spieler.plugins.flashBlockDetector=function(spieler,elements,config){if(Spieler.browser.is.smartphone||Spieler.browser.is.safari||!Spieler.browser.has.flash()){spieler.hooks.add("pre-init",function(data,callback){spieler.dispatcher.dispatch(events.NOFLASH);callback(null,data)},"flashblockdetector",true);return}var timer;var SWF_URL=Spieler.path+"swf/spieler.detect.swf";var TIMEOUT=5e3;function load(){console.log(P+"loading dummy swf with "+TIMEOUT+"ms timeout");spieler.dispatcher.dispatch(events.WAITING);var fParams={wmode:"transparent",allowscriptaccess:"always"};var fAttrs={"class":"fbd-swf"+(!Spieler.browser.is.ie?" hidden":"")};var obj=utils.embedFlash(SWF_URL,fParams,fAttrs);timer=Date.now();elements.ui.appendChild(obj);dom.addClass(elements.main,"flashblockdetector");return obj}function dispatchResult(result){spieler.dispatcher.dispatch(events.FLASHBLOCK,result);spieler.dispatcher.dispatch(result?events.HASFLASHBLOCK:events.NOFLASHBLOCK)}function onPing(){result=false;dispatchResult(result);cleanup()}function cleanup(){console.log(P+"cleaning up...");dispatcher.remove("PING",onPing);dom.removeClass(elements.main,"flashblockdetector");var t=Date.now()-timer;setTimeout(function(){if(objectElement&&objectElement.parentNode){utils.deleteFlash(objectElement)}else{var element=elements.ui.querySelector(".fbd-swf");if(element.parentNode){element.parentNode.removeChild(element)}}objectElement=null},t<1e3?1e3-t:0)}var objectElement;spieler.hooks.add("pre-init",function(data,callback){var ret=function(){console.log(P+"unblocked playback with denyFlash: "+result);data.configOverrides.denyFlash=result;callback(null,data)};if(result!==null){ret()}else{console.log(P+"delaying playback until flashblock detection is done");spieler.dispatcher.add(events.FLASHBLOCK,ret)}},"flashblockdetector",true);dispatcher.add("PING",onPing);if(result===null){objectElement=load();window.setTimeout(function(){if(result===null){console.log(P+"timeout exceeded. No Flash.");result=true;cleanup();dispatchResult(true)}},TIMEOUT)}else{dispatchResult(result)}};Spieler.plugins.flashBlockDetector.ping=function(){console.log(P+"response recieved, Flash is enabled.");dispatcher.dispatch("PING")};Spieler.plugins.flashBlockDetector.reset=function(){result=null};events=Spieler.plugins.flashBlockDetector.events={NOFLASH:"FLASHBLOCKDETECTOR.NOFLASH",FLASHBLOCK:"FLASHBLOCKDETECTOR.FLASHBLOCK",WAITING:"FLASHBLOCKDETECTOR.WAITING",HASFLASHBLOCK:"FLASHBLOCKDETECTOR.HASFLASHBLOCK",NOFLASHBLOCK:"FLASHBLOCKDETECTOR.NOFLASHBLOCK"}})();Spieler.plugins.googleTagManager=function(spieler,elements,config){"use strict";var dataLayer;if(typeof config==="object"){if(typeof config.dataLayerHandle==="string"){dataLayer=window[config.dataLayerHandle]}else if(typeof config.dataLayerHandle==="object"){dataLayer=config.dataLayerHandle}else{dataLayer=window.dataLayer}}if(!dataLayer){throw new Error("GTM dataLayer global is not available")}var paused=false;var lastSource=null;if(config.events&&config.events.videoLoad){spieler.dispatcher.add(Spieler.events.GETSIZE,function(e,duration){if(!spieler.media){return}if(spieler.media.active()==lastSource){return}else{lastSource=spieler.media.active()}if(!config.trackAds&&spieler.media.metadata&&spieler.media.metadata.advertisement){return}var data={event:"spieler-video-load","spieler-platform":spieler.media.platform()===Media.PLATFORM.HTML5?"HTML5":"Flash","spieler-video-title":spieler.media.metadata?spieler.media.metadata.title:null,"spieler-video-id":spieler.media.metadata?spieler.media.metadata.id:null,"spieler-duration":duration,"spieler-video-type":spieler.media.metadata&&spieler.media.metadata.advertisement?"advertisement":"content"};dataLayer.push(data)})}if(config.events&&config.events.videoEnd){spieler.dispatcher.add(Spieler.events.END,function(){if(!spieler.media){return}if(!config.trackAds&&spieler.media.metadata&&spieler.media.metadata.advertisement){return}dataLayer.push({event:"spieler-video-end"})})}if(config.events&&config.events.videoPause){spieler.dispatcher.add(Spieler.events.PAUSE,function(){if(!spieler.media){return}if(!config.trackAds&&spieler.media.metadata&&spieler.media.metadata.advertisement){return}dataLayer.push({event:"spieler-video-pause"});paused=true})}if(config.events&&config.events.videoResume){spieler.dispatcher.add(Spieler.events.PLAY,function(){if(!spieler.media){return}if(!config.trackAds&&spieler.media.metadata&&spieler.media.metadata.advertisement){return}if(!paused){return}dataLayer.push({event:"spieler-video-resume"})})}if(config.events&&config.events.videoProgress){spieler.dispatcher.add(Spieler.events.TIMEUPDATE,function(e,time){if(!spieler.media){return}if(!config.trackAds&&spieler.media.metadata&&spieler.media.metadata.advertisement){return}var data={event:"spieler-video-progress","spieler-current-time":time};dataLayer.push(data)})}};"use strict";var LOG_PREFIX="Spieler DFP SdkWrapper:";function SdkWrapper(locale){Reactor.apply(this,arguments);var self=this;var log=console.log.bind(console,LOG_PREFIX);var info=console.info.bind(console,LOG_PREFIX);var error=console.error.bind(console,LOG_PREFIX);var adDisplayContainer;var adsLoader;var adsManager;var videoContent;var adContainer;var duration;var state={adsLoaded:false,contentInitialized:false,userRequestContext:{}};var handlers={loaded:function(adsManagerLoadedEvent){log("adsManager loaded");state.userRequestContext=adsManagerLoadedEvent.getUserRequestContext();self.dispatchEvent(new CustomEvent("loaded-pre"));self.destroyAdsManager();adsManager=getAdsManager(adsManagerLoadedEvent);addAdsManagerListeners(adsManager);state.adsLoaded=true;self.dispatchEvent(new CustomEvent("loaded-post",{detail:{createdAdsManager:!!adsManager}}))},adLoaded:function(adEvent){log("ad loaded");self.dispatchEvent(new CustomEvent("adLoaded",{detail:{ad:adEvent.getAd()}}))},error:function(adErrorEvent){error("ad error",adErrorEvent.getError());var data={detail:{adErrorEvent:adErrorEvent,userRequestContext:adErrorEvent.getUserRequestContext()||state.userRequestContext}};if(adsManager){error("current failed ad:",adsManager.getCurrentAd());data.detail.currentAd=adsManager.getCurrentAd()}duration=-1;self.dispatchEvent(new CustomEvent("error",data));state.userRequestContext={}},ended:function(){log("ad ended");duration=-1;self.dispatchEvent(new CustomEvent("ended"));state.userRequestContext={}},paused:function(){log("ad paused");self.dispatchEvent(new CustomEvent("paused"))},resumed:function(){log("ad playing");self.dispatchEvent(new CustomEvent("playing"))},volumeChanged:function(){log("ad volume changed");self.dispatchEvent(new CustomEvent("volume-changed"))},muted:function(){log("ad muted");self.dispatchEvent(new CustomEvent("muted"))},clicked:function(){log("ad clicked");self.dispatchEvent(new CustomEvent("clicked"))},started:function(adEvent){log("ad started");var ad=adEvent.getAd();duration=ad.getDuration();self.dispatchEvent(new CustomEvent("started",{detail:{adEvent:adEvent}}))},firstQuartile:function(){log("ad 25%, passed firstQuartile");self.dispatchEvent(new CustomEvent("firstQuartile"))},midpoint:function(){log("ad 50%, passed midpoint");self.dispatchEvent(new CustomEvent("midpoint"))},thirdQuartile:function(){log("ad 75%, passed thirdQuartile");self.dispatchEvent(new CustomEvent("thirdQuartile"))},stopped:function(){log("ad stopped");self.dispatchEvent(new CustomEvent("stopped"));state.userRequestContext={}},skipped:function(){log("ad skipped");self.dispatchEvent(new CustomEvent("skipped"))}};function getAdsManagerHandlers(sdk){return[[sdk.AdErrorEvent.Type.AD_ERROR,"error"],[sdk.AdEvent.Type.CONTENT_RESUME_REQUESTED,"ended"],[sdk.AdEvent.Type.PAUSED,"paused"],[sdk.AdEvent.Type.RESUMED,"resumed"],[sdk.AdEvent.Type.VOLUME_CHANGED,"volumeChanged"],[sdk.AdEvent.Type.VOLUME_MUTED,"muted"],[sdk.AdEvent.Type.CLICK,"clicked"],[sdk.AdEvent.Type.STARTED,"started"],[sdk.AdEvent.Type.FIRST_QUARTILE,"firstQuartile"],[sdk.AdEvent.Type.MIDPOINT,"midpoint"],[sdk.AdEvent.Type.THIRD_QUARTILE,"thirdQuartile"],[sdk.AdEvent.Type.COMPLETE,"stopped"],[sdk.AdEvent.Type.SKIPPED,"skipped"],[sdk.AdEvent.Type.LOADED,"adLoaded"]]}function getAdsLoaderHandlers(sdk){return[[sdk.AdErrorEvent.Type.AD_ERROR,"error"],[sdk.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,"loaded"]]}function addAdsLoaderHandlers(adsLoader){getAdsLoaderHandlers(google.ima).forEach(function(kvPair){var eventName=kvPair[0];var handler=handlers[kvPair[1]];adsLoader.addEventListener(eventName,handler)})}function addAdsManagerListeners(adsManager){getAdsManagerHandlers(google.ima).forEach(function(kvPair){var eventName=kvPair[0];var handler=handlers[kvPair[1]];adsManager.addEventListener(eventName,handler)})}function removeAdsManagerListeners(adsManager){getAdsManagerHandlers(google.ima).forEach(function(kvPair){var eventName=kvPair[0];var handler=handlers[kvPair[1]];adsManager.removeEventListener(eventName,handler)})}function getAdsManager(adsManagerLoadedEvent){var adsRenderingSettings=new google.ima.AdsRenderingSettings;adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete=false;return adsManagerLoadedEvent.getAdsManager(videoContent,adsRenderingSettings)}this.startAds=function(){var success=false;if(state.adsLoaded&&state.contentInitialized){try{adsManager.init(adContainer.offsetWidth,adContainer.offsetHeight,google.ima.ViewMode.NORMAL);adsManager.start();success=true}catch(adError){handlers.error(adError)}}return success};this.resize=function(width,height,mode){adsManager.resize(width,height,mode)};this.destroyAdsManager=function(delayed){if(adsManager){function destroy(delayed){removeAdsManagerListeners(adsManager);adsManager.destroy();log("AdsManager destroyed"+(delayed?" (delayed)":""))}if(delayed){setTimeout(destroy.bind(this,delayed),0)}else{destroy()}}};this.setVolume=function(volume){if(adsManager){adsManager.setVolume(volume)}};this.getVolume=function(){if(adsManager){return adsManager.getVolume()}else{return null}};this.getRemainingTime=function(){if(adsManager){return adsManager.getRemainingTime()}else{return null}};this.getDuration=function(){if(adsManager){return duration}else{return null}};this.stop=function(){if(adsManager){adsManager.stop()}};this.pause=function(){if(adsManager){adsManager.pause()}};this.resume=function(){if(adsManager){adsManager.resume()}};this.createAdDisplayContainer=function(_adContainer,_videoContent){adContainer=_adContainer;videoContent=_videoContent;adDisplayContainer=new google.ima.AdDisplayContainer(adContainer,videoContent)};this.initAdDisplayContainer=function(){adDisplayContainer.initialize()};this.createAdsLoader=function(){adsLoader=new google.ima.AdsLoader(adDisplayContainer);addAdsLoaderHandlers(adsLoader)};this.requestAd=function(adTag,options){options=!options?{}:options;var adsRequest=new google.ima.AdsRequest;state.userRequestContext={};if(options.autoplay){adsRequest.setAdWillAutoPlay(true)}adsRequest.adTagUrl=adTag;adsRequest.linearAdSlotWidth=640;adsRequest.linearAdSlotHeight=400;adsRequest.nonLinearAdSlotWidth=options.nonLinearWidth?options.nonLinearWidth:adContainer.offsetWidth;adsRequest.nonLinearAdSlotHeight=options.nonLinearHeight?options.nonLinearHeight:150;state.userRequestContext.adsRequest=adsRequest;state.userRequestContext.adTagParams={};adTag.substr(adTag.indexOf("?")+1,adTag.length-1).split("&").map(function(curr,idx,array){var key=curr.split("=")[0];var value=curr.split("=")[1];this[key]=value},state.userRequestContext.adTagParams);adsLoader.requestAds(adsRequest,state.userRequestContext)};this.setContentInitialized=function(newValue){state.contentInitialized=newValue};this.isContentInitialized=function(){return state.contentInitialized};this.isAdsLoaderReady=function(){return!!adsLoader};this.triggerContentComplete=function(){adsLoader.contentComplete()};google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE);google.ima.settings.setLocale(locale)}SdkWrapper.prototype=Object.create(Reactor.prototype);function FlashScreen(element,spieler,media,acceleration){"use strict";var flashElement;var self=this;var swfPath=Spieler.path+"swf/";var swfFileName="spieler.swf";if(isDebugEnabled){swfFileName="spieler.debug.swf"}if(media.platform()&Media.PLATFORM.FLASHHDCORE){swfFileName="spieler.hdcore.swf"}else if(media.platform()&Media.PLATFORM.FLASHHLS){swfFileName="spieler.hls.swf"}var swfUrl=swfPath+swfFileName;var _lastPassiveState=spieler.getPassiveState();var _destroyed=false;var state={acceleration:acceleration!==undefined?acceleration:true};this.isDestroyed=function(){return _destroyed};this.currentTime=function(value){return flashElement?flashElement.currentTime(value):0};this.volume=function(value){return flashElement?flashElement.volume(value):0};this.muted=function(value){return flashElement?flashElement.muted(value):0};this.duration=function(){return flashElement?flashElement.getDuration():0};this.abs=function(value){return flashElement?flashElement.abs(value):false};this.quality=function(value){return flashElement?flashElement.getQuality(value):0};this.qualities=function(){return flashElement?flashElement.qualities():0};this.qualityList=function(){return flashElement?flashElement.qualityList():[]};this.acceleration=function(){return state.acceleration};this.destroy=function(){_destroyed=true;spieler.dispatcher.remove(Spieler.events.PLAY,onSpielerPlay);spieler.dispatcher.remove(Spieler.events.PAUSE,onSpielerPause);spieler.dispatcher.remove(Spieler.events.END,onSpielerEnd);spieler.dispatcher.remove(Spieler.events.DURATIONCHANGE,seekToStart);spieler.dispatcher.remove(Spieler.events.TIMEUPDATE,onTimeupdate);if(flashDiv!==null){if(flashDiv.parentNode){utils.deleteFlash(flashDiv)}flashDiv=null}flashElement=null;if(element&&element.parentNode){dom.removeClass(element.parentNode,"backgroundHack")}spieler.dispatcher.dispatch(Spieler.events.SCREENDESTROY)};function onSpielerPlay(event,data){if(!_lastPassiveState||!data||!data.feedback){flashElement.playVideo()}}function onSpielerPause(event,data){if(!_lastPassiveState||!data||!data.feedback){flashElement.pauseVideo()}}this.resume=function(){if(!_lastPassiveState)flashElement.playVideo()};function onSpielerEnd(event,data){if(!_lastPassiveState||!data||!data.feedback){self.destroy()}}function delayedLoad(){console.log("FlashScreen.delayedLoad()");scheduleSeek();if(!media||!media.active())return;flashElement.load(media.active(),spieler.volume(),spieler.muted());if(!spieler.playing()){onSpielerPause()}spieler.dispatcher.add(Spieler.events.PLAY,onSpielerPlay);spieler.dispatcher.add(Spieler.events.PAUSE,onSpielerPause);spieler.dispatcher.add(Spieler.events.END,onSpielerEnd);spieler.dispatcher.add(Spieler.events.TIMEUPDATE,onTimeupdate)}var seekScheduled=false;function scheduleSeek(){if(seekScheduled||!flashElement){return}if(media&&media.metadata&&media.metadata.clip){spieler.dispatcher.addOnce(Spieler.events.DURATIONCHANGE,seekToStart);seekScheduled=true}}function seekToStart(){if(flashElement){flashElement.currentTime(media.metadata.clip.start)}seekScheduled=false}function onTimeupdate(){if(flashElement&&media.metadata.clip){if(flashElement.currentTime(null)>=media.metadata.clip.stop){spieler.pause();spieler.dispatcher.remove(Spieler.events.TIMEUPDATE,onTimeupdate);self.destroy();spieler.dispatcher.dispatch(Spieler.events.END)}}}spieler.dispatcher.addOnce(FlashScreen.events.REGISTER,function(eventName,buildNumber){flashElement=document.getElementById(spieler.upid());Spieler.flash.buildNumber=buildNumber;setTimeout(delayedLoad,10)});spieler.dispatcher.addOnce(Spieler.events.MEDIACHANGE,function(){self.destroy()});spieler.dispatcher.add(Spieler.events.PASSIVESTATECHANGED,function(eventName,newState){_lastPassiveState=newState});var params={bgcolor:"#000000",wmode:"opaque",allowfullscreen:true,allowscriptaccess:"always",flashvars:"upid="+spieler.upid()+"&acceleration="+state.acceleration};var attrs={width:"100%",height:"100%",id:spieler.upid()};var flashDiv=document.createElement("div");flashDiv.setAttribute("style","width:100%;height:100%;background-color:#000");flashDiv.appendChild(utils.embedFlash(swfUrl,params,attrs));element.appendChild(flashDiv);if(Spieler.browser.is.ie&&Spieler.browser.is.ie<=10){dom.addClass(element.parentNode,"backgroundHack")}}FlashScreen.events={REGISTER:"REGISTER",BITRATECHANGE:"BITRATECHANGE"};function TagScreen(element,spieler,media,state){"use strict";var hlsInstance;var videoElement=element.querySelector("video");var self=this;var currentTime=0;var currentMedia;var errorMap={};errorMap[MediaError.MEDIA_ERR_ABORTED]="VIDEO_ERROR_ABORTED";errorMap[MediaError.MEDIA_ERR_NETWORK]="VIDEO_ERROR_NETWORK";errorMap[MediaError.MEDIA_ERR_DECODE]="VIDEO_ERROR_DECODE";errorMap[MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED]="VIDEO_ERROR_SRC_NOT_SUPPORTED";var getsizeSent=false;var endSent=false;var waitingForReload=false;var seekScheduled=false;var lastPassiveState=spieler.getPassiveState();var destroyed=false;var ended=false;var metaDataSent=false;var recoverAttempts=3;function setVideoSource(videoElement,media,done,state){function initHLS(){recoverAttempts=3;hlsInstance=new Hls({autoStartLoad:false,startLevel:-1,stretchShortVideoTrack:true,debug:isHlsJsDebugEnabled,xhrSetup:function(xhr,url){xhr.withCredentials=true}});hlsInstance.attachMedia(videoElement);var isMediaAttached=false;hlsInstance.on(Hls.Events.MEDIA_ATTACHED,function(){hlsInstance.loadSource(source);isMediaAttached=true});hlsInstance.on(Hls.Events.MANIFEST_PARSED,function(){if(isMediaAttached){hlsInstance.autoLevelCapping=hlsInstance.levels.length-1;hlsInstance.startLoad();if(typeof done==="function"){done()}}});hlsInstance.on(Hls.Events.ERROR,function(event,data){if(data&&data.fatal){if(recoverAttempts>0){recoverAttempts--;switch(data.type){case Hls.ErrorTypes.NETWORK_ERROR:console.info("HLSJS: fatal network error, won't recover",data.details);recoverAttempts=0;spieler.dispatcher.dispatch(Spieler.events.ERROR,{hlsjs:data});break;case Hls.ErrorTypes.MEDIA_ERROR:console.info("HLSJS: trying to recover fatal media error",data.details);hlsInstance.recoverMediaError();break;default:console.error("HLSJS: other fatal media error encountered, cannot recover",data.details);recoverAttempts=0;spieler.dispatcher.dispatch(Spieler.events.ERROR,{hlsjs:data});break}}else{console.error("HLSJS: could not recover after maximum number of attempts",data.details);spieler.dispatcher.dispatch(Spieler.events.ERROR,{hlsjs:data})}}else{console.info("HLSJS: non-fatal error occurred",data.details)}})}var source=media.active().url;if(media.platform()&Media.PLATFORM.HLSJS){if(!window.Hls){dom.addScript(Spieler.path+"lib/hls.min.js",function(){console.log("loaded hls.min.js");initHLS()},function(){console.error("failed to load hls.min.js")})}else{initHLS()}}else{videoElement.src=source;if(typeof done==="function"){done()}}}function onTimeupdate(){if(state.passive||utils.isEmptyVideo(this)){return}currentTime=videoElement.currentTime;if(spieler.playState()==="paused"&&!videoElement.paused){console.warn("TagScreen: playState is out of sync!")}if(spieler.playState()==="playing"){spieler.dispatcher.dispatch(Spieler.events.TIMEUPDATE,currentTime)}if(videoElement.duration>3&&currentTime>videoElement.duration-3||currentTime>videoElement.duration*.8){spieler.dispatcher.dispatch(Spieler.events.ALMOSTENDED,currentTime)}if(currentMedia.metadata.clip){if(currentTime>=currentMedia.metadata.clip.stop){spieler.pause();onEnded()}}}function onDurationchange(e){if(waitingForReload){return false}if(!state.passive&&!utils.isEmptyVideo(e.target)){spieler.dispatcher.dispatch(Spieler.events.DURATIONCHANGE,videoElement.duration)}}function onError(e){if(!state.passive&&!utils.isEmptyVideo(e.target)){if(e.target.error){var error=errorMap[e.target.error.code]||"VIDEO_ERROR_UNKNOWN";spieler.dispatcher.dispatch(Spieler.events.ERROR,error)}else{console.warn("TagScreen: an unspecified error occured on the video element")}}}function onLoadedmeta(){if(state.passive||utils.isEmptyVideo(this)){return}if(waitingForReload){waitingForReload=false;return}if(videoElement.videoWidth&&videoElement.videoHeight&&!metaDataSent){metaDataSent=true;spieler.dispatcher.dispatch(Spieler.events.GETSIZE,{width:videoElement.videoWidth,height:videoElement.videoHeight});getsizeSent=true}}function onPlaying(){endSent=false;if(state.passive||utils.isEmptyVideo(this)){return}if(!getsizeSent){spieler.dispatcher.dispatch(Spieler.events.GETSIZE,{width:videoElement.videoWidth,height:videoElement.videoHeight});getsizeSent=true}if(Spieler.browser.is.ie){videoElement.playbackRate=state.pRate}spieler.dispatcher.dispatch(Spieler.events.PLAYING)}function onPausing(){if(state.passive){return}spieler.dispatcher.dispatch(Spieler.events.PAUSED)}function onContextMenu(evt){evt.stopImmediatePropagation();evt.preventDefault()}function onEnded(event){console.log("TagScreen: Ended with event: ",event);metaDataSent=false;if(state.passive||utils.isEmptyVideo(videoElement)){return}if(!endSent){spieler.dispatcher.dispatch(Spieler.events.END);endSent=true;utils.resetVideoElement(videoElement);if(hlsInstance){hlsInstance.destroy();hlsInstance=null}}}function scheduleSeek(){if(!seekScheduled&&videoElement&&currentMedia&&currentMedia.metadata&&currentMedia.metadata.clip){console.log("scheduleSeek");spieler.dispatcher.addOnce(Spieler.events.DURATIONCHANGE,seekToStart);seekScheduled=true}}function seekToStart(){seekScheduled=false;if(currentMedia.metadata&&currentMedia.metadata.clip&&currentMedia.metadata.clip.start){var targetTime=currentMedia.metadata.clip.start||0;console.log("seekToStart",targetTime);videoElement.currentTime=targetTime}}function onVolumeChange(e){if(state.passive||utils.isEmptyVideo(videoElement)){return}spieler.volume(videoElement.volume);spieler.muted(videoElement.muted)}function onSpielerPLAY(event,data){if(!state.passive||!data||!data.feedback){videoElement.play()}}function onSpielerPAUSE(event,data){if(!state.passive||!data||!data.feedback){videoElement.pause()}}function onSpielerMEDIACHANGE(){utils.resetVideoElement(videoElement);if(hlsInstance){hlsInstance.destroy();hlsInstance=null}}function onSpielerPASSIVESTATECHANGED(eventName,newState){if(lastPassiveState!==newState){lastPassiveState=newState;if(lastPassiveState){metaDataSent=false}}}function onSpielerPOSTCLIPDONE(){waitingForReload=true;dom.prop(videoElement,"autoplay",false)}function onSpielerDURATIONCHANGE(){ended=false}function onSpielerEND(){ended=true}this.enableNativeControls=function(){videoElement.controls=true;nativeCallbacks(true)};this.isDestroyed=function(){return destroyed};this.currentTime=function(value){if(value!==undefined){videoElement.currentTime=value}return currentTime};this.volume=function(value){if(value!==undefined){if(value<0){value=0}else if(value>1){value=1}videoElement.volume=value}return videoElement.volume};this.muted=function(value){if(value!==undefined){dom.prop(videoElement,"muted",value)}return videoElement.muted};this.buffered=function(){return videoElement.buffered.length?videoElement.buffered.end(0):0};this.duration=function(){return videoElement.duration};this.abs=function(){return hlsInstance?true:false};this.quality=function(value){return hlsInstance?-1:currentMedia.quality(value)};this.qualityList=function(){return hlsInstance?[]:currentMedia.qualityList()};this.qualities=function(){return hlsInstance?0:currentMedia.qualities()};this.destroy=function(eventName){destroyed=true;if(eventName==="POSTCLIPDONE"){onSpielerPOSTCLIPDONE()}spieler.dispatcher.remove(Spieler.events.PLAY,onSpielerPLAY);spieler.dispatcher.remove(Spieler.events.PAUSE,onSpielerPAUSE);spieler.dispatcher.remove(Spieler.events.MEDIACHANGE,onSpielerMEDIACHANGE);spieler.dispatcher.remove(Spieler.events.POSTCLIPDONE,onSpielerPOSTCLIPDONE);var events={timeupdate:[onTimeupdate],durationchange:[onDurationchange,seekToStart],error:[onError],loadedmetadata:[onLoadedmeta],playing:[onPlaying],pause:[onPausing],ended:[onEnded],volumechange:[onVolumeChange],contextmenu:[onContextMenu]};Object.keys(events).forEach(function(name){events[name].forEach(function(handler){dom.off(videoElement,name,handler);dom.off(videoElement,name,handler,true)})});if(hlsInstance){hlsInstance.destroy();hlsInstance=null}videoElement.pause()};this.changeSource=function(media){currentMedia=media;setVideoSource(videoElement,media,function(){scheduleSeek();if(spieler.playing()){videoElement.play()}getsizeSent=false;metaDataSent=false;endSent=false})};this.getHlsInstance=function(){return hlsInstance?hlsInstance:undefined};this.resume=function(){if(!state.passive){videoElement.play()}};this.autoplay=function(newValue){return dom.prop(videoElement,"autoplay",newValue)};this.playbackRate=function(value){videoElement.playbackRate=value};if(media){this.changeSource(media)}else{utils.resetVideoElement(videoElement)}this.muted(spieler.muted());this.playbackRate(state.pRate);state.volume=this.volume(state.volume);dom.on(videoElement,"timeupdate",onTimeupdate);dom.on(videoElement,"durationchange",onDurationchange);dom.on(videoElement,"error",onError,true);dom.on(videoElement,"loadedmetadata",onLoadedmeta);dom.on(videoElement,"playing",onPlaying);dom.on(videoElement,"pause",onPausing);dom.on(videoElement,"volumechange",onVolumeChange);dom.on(videoElement,"contextmenu",onContextMenu);dom.on(videoElement,"ended",onEnded);spieler.dispatcher.add(Spieler.events.PLAY,onSpielerPLAY);spieler.dispatcher.add(Spieler.events.PAUSE,onSpielerPAUSE);spieler.dispatcher.add(Spieler.events.MEDIACHANGE,onSpielerMEDIACHANGE);spieler.dispatcher.add(Spieler.events.POSTCLIPDONE,onSpielerPOSTCLIPDONE)}function Benchmark(){var LOG_PREFIX="Benchmark:";var log=console.log.bind(console,LOG_PREFIX);var info=console.info.bind(console,LOG_PREFIX);var error=console.error.bind(console,LOG_PREFIX);var warn=console.warn.bind(console,LOG_PREFIX);this.data={};function newBenchData(){return{logs:[],getLogs:function(){return this.logs.map(function(val){return val.sinceStart+"ms : [ "+val.name+" ] "+val.message+" ("+val.sinceLast+"ms)"})},total:0,started:false,finished:false,startTime:0,endTime:0,previousLogTime:0}}this.start=function(type,name,message){if(!this.data[type]){this.data[type]=newBenchData()}else{warn('"'+type+'" was already started -> resetting.')}this.data[type].started=true;this.data[type].previousLogTime=this.data[type].startTime=Date.now();this.log(type,name||"start",message)};this.log=function(type,name,message){var entry=this.data[type];if(entry&&!entry.finished){var now=Date.now();entry.logs.push({name:name||"log"+entry.logs.length,message:message||"",
sinceStart:now-entry.startTime,sinceLast:now-entry.previousLogTime,timestamp:now});entry.previousLogTime=now}else{warn('"'+type+'" was not started, canceling log.')}};this.finish=function(type,name,message){var entry=this.data[type];if(entry&&!entry.finished){this.log(type,name||"finish",message);entry.finished=true;entry.endTime=Date.now();entry.total=entry.endTime-entry.startTime}};this.getResults=function(type){var _data=this.data;return type?{logs:this.data[type].getLogs(),finished:this.data[type].finished,total:this.data[type].total}:Object.keys(this.data).reduce(function(acc,val){acc[val]={logs:_data[val].getLogs(),finished:_data[val].finished,total:_data[val].total};return acc},{})};this.has=function(type,name){try{return!!this.data[type].logs.find(function(element){return element.name===name},this)}catch(e){return false}};this.measure=function(var_args){var type1=arguments[0],log1=arguments[1],type2,log2,time1,time2;if(arguments.length===3){log2=arguments[2];try{var arr=this.data[type1].logs.slice().reverse();time1=arr.find(function(element){return element.name===log1},this).timestamp;time2=arr.find(function(element){return element.name===log2},this).timestamp}catch(e){warn("measure(), can't find one of those: "+log1+"="+time1+", "+log2+"="+time2)}return time2-time1}else if(arguments.length===4){type2=arguments[2];log2=arguments[3];try{time1=this.data[type1].logs.slice().reverse().find(function(element){return element.name===log1},this).timestamp;time2=this.data[type2].logs.slice().reverse().find(function(element){return element.name===log2},this).timestamp}catch(e){warn("measure(), can't find one of those: "+log1+"="+time1+", "+log2+"="+time2)}return time2-time1}else{warn("measure(), incorrect number of arguments.")}}}var benchmark=isBenchmarkEnabled?new Benchmark:{data:DUMMY,start:DUMMY,log:DUMMY,finish:DUMMY,getResults:DUMMY,measure:DUMMY};Spieler.benchmark=benchmark;function Browser(){"use strict";function isInUserAgent(txt){return navigator.userAgent.indexOf(txt)!==-1}function getIEVersion(){if(isInUserAgent("MSIE")){return parseInt(navigator.userAgent.match(/MSIE (\d+)/)[1])}else if(isInUserAgent("Trident/")){return parseInt(navigator.userAgent.match(/rv:(\d+)/)[1])}else{return false}}function getIOSVersion(){if(isInUserAgent("iPhone")||isInUserAgent("iPad")){var raw=navigator.userAgent.match(/OS (\d+)_/);if(raw!==null&&raw.length>=2){return+raw[1]}}return false}function getChromeVersion(){var version=false;if(isInUserAgent("Chrome")&&!isInUserAgent("Edge/")&&!isInUserAgent("OPR")&&!isInUserAgent("Opera")){var matches=navigator.userAgent.match(/Chrome\/(\d+)/);if(matches!==null){version=parseInt(matches[1])}}return version}this.is={firefox:isInUserAgent("Firefox"),chrome:getChromeVersion(),opera:isInUserAgent("Opera")||isInUserAgent("OPR"),iosWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent)||isInUserAgent("CriOS"),android:isInUserAgent("Android"),ie:getIEVersion(),edge:isInUserAgent("Edge/"),iPad:isInUserAgent("iPad"),iPhone:isInUserAgent("iPhone"),iOS:getIOSVersion(),OSX:isInUserAgent("Macintosh"),desktopSafari:isInUserAgent("Macintosh")&&isInUserAgent("Safari")&&!isInUserAgent("Chrome"),smartphone:isInUserAgent("Android")||isInUserAgent("iPad")||isInUserAgent("iPhone")||isInUserAgent("Windows Phone")||isInUserAgent("Mobile"),safari:false,desktop:!(isInUserAgent("Android")||isInUserAgent("iPad")||isInUserAgent("iPhone")||isInUserAgent("Windows Phone")||isInUserAgent("Mobile"))};if(!(this.is.firefox||this.is.chrome||this.is.opera)&&isInUserAgent("Safari")){this.is.safari=true}else if(this.is.android){var version=navigator.userAgent.match(/Android\s([0-9\.]*)/);if(!version&&this.is.firefox){version="2.3"}else if(version){version=version[1]}if(version&&version.length>=2){this.is.android=version.split(".");for(var i=0;i<this.is.android.length;i++){this.is.android[i]=+this.is.android[i]}if(this.is.android.length<3){this.is.android[2]=0}}}else if(this.is.chrome&&this.is.ie){this.is.chrome=false}this.sizeClass={toString:function(){return this.value}};(function updateSize(){var sizeBreakpoints={xs:0,sm:768,md:992,lg:1200};var key;var last;var size=window.screen.width;if(this.is.smartphone&&window.screen.width>window.screen.height){size=window.screen.height}for(key in sizeBreakpoints){if(size>=sizeBreakpoints[key]){if(last){this.sizeClass[last]=false}this.sizeClass[key]=true;this.sizeClass.value=key;last=key}else{this.sizeClass[key]=false}}this.sizeClass.phone=this.sizeClass.xs;this.sizeClass.tablet=this.sizeClass.sm;this.sizeClass.desktop=this.sizeClass.md||this.sizeClass.lg}).apply(this);this.supports={fullScreen:document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitRequestFullScreen,localStorage:isLocalStorageSupported,html5:{video:!!document.createElement("video").canPlayType},css3:{transitions:function(){var keys=[];for(var key in document.createElement("div").style){if(/transition/i.test(key)){keys.push(key)}}return keys.length>0}()}};var cached={};this.has={};cached.has={};this.has.flash=function(){if(cached.has.flash===null){cached.has.flash=false;try{if(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")){cached.has.flash=true}}catch(e){var mime="application/x-shockwave-flash";var mimes=navigator.mimeTypes;if(mimes&&mimes[mime]&&mimes[mime].enabledPlugin){cached.has.flash=true}}}return cached.has.flash};cached.has.flash=null;this.fs={};if(typeof HTMLElement==="undefined"){HTMLElement={prototype:{}}}else if(typeof HTMLElement.prototype==="undefined"){HTMLElement.prototype={}}if(typeof HTMLVideoElement==="undefined"){HTMLVideoElement={prototype:{}}}else if(typeof HTMLVideoElement.prototype==="undefined"){HTMLVideoElement.prototype={}}var p;if(window.HTMLDocument!==undefined){p=HTMLDocument.prototype}else{p=Document.prototype}this.fs.changeEvent="onmozfullscreenchange"in p?"mozfullscreenchange":"onwebkitfullscreenchange"in p?"webkitfullscreenchange":"onmsfullscreenchange"in p?"MSFullscreenChange":"onfullscreenchange"in p?"fullscreenchange":null;this.fs.nativeChangeEvents=["webkitbeginfullscreen","webkitendfullscreen"];p=HTMLElement.prototype;this.fs.request="mozRequestFullScreen"in p?"mozRequestFullScreen":"webkitRequestFullscreen"in p?"webkitRequestFullscreen":"msRequestFullscreen"in p?"msRequestFullscreen":"requestFullscreen"in p?"requestFullscreen":"webkitEnterFullscreen"in HTMLVideoElement.prototype?"webkitEnterFullscreen":null;if(window.HTMLDocument!==undefined){p=HTMLDocument.prototype}else{p=Document.prototype}this.fs.exit="mozCancelFullScreen"in p?"mozCancelFullScreen":"webkitExitFullscreen"in p?"webkitExitFullscreen":"msExitFullscreen"in p?"msExitFullscreen":"exitFullscreen"in p?"exitFullscreen":null;this.fs.exitNative="webkitExitFullscreen"in HTMLVideoElement.prototype?"webkitExitFullscreen":null;this.fs.html5=!!this.fs.exit;this.fs.native=this.fs.html5||!!this.fs.exitNative;if((this.is.ie===false||this.is.ie>8)&&typeof Object.defineProperty!=="undefined"){Object.defineProperty(this,"fullscreenElement",{get:function(){return this.fs.fullscreenElement}});Object.defineProperty(this.fs,"fullscreenElement",{get:function getFullscreenElement(){var keys=["fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement"];var fullscreenKey=keys.find(function(key){return document[key]!==undefined});return fullscreenKey===undefined?undefined:document[fullscreenKey]}});Object.defineProperty(this.fs,"fullscreenEnabled",{get:function getFullscreenElement(){var keys=["webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled","fullscreenEnabled"];var fullscreenKey=keys.find(function(key){return document[key]!==undefined});return fullscreenKey===undefined?undefined:document[fullscreenKey]}})}this.fs.isFullscreenElement=function(element){if(element){return this.fullscreenElement!==undefined?this.fullscreenElement===element:element.webkitDisplayingFullscreen}};this.isFullscreenElement=this.fs.isFullscreenElement.bind(this.fs);this.supportsHlsJs=function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}}function Dispatcher(){Reactor.apply(this,arguments);var self=this;"use strict";var wrappers={};var onceWrappers={};var _add=self.addEventListener;var _remove=self.removeEventListener;var _dispatch=self.dispatchEvent;function getWrapper(handlerFunc){return function(evtObj){handlerFunc(evtObj.type,evtObj.detail)}}function registerHandler(eventName,handlerFunc,wrapperFunc,isOnce){var dictionary=isOnce===true?onceWrappers:wrappers;if(dictionary[eventName]===undefined){dictionary[eventName]=[]}var found=false;var i=0,len=dictionary[eventName].length;for(i;i<len;i++){if(dictionary[eventName][i].original===handlerFunc){found=true;break}}if(found===false){dictionary[eventName].push({wrapper:wrapperFunc,original:handlerFunc});return true}return false}function deleteHandler(eventName,handlerFunc,isOnce){var dict=isOnce===true?onceWrappers:wrappers;if(dict[eventName]!==undefined){var len=dict[eventName].length;var i=0,found=false;for(i;i<len;i++){if(dict[eventName][i].original===handlerFunc){dict[eventName].splice(i,1);found=true;break}}}return found}this.add=function(eventName,handlerFunc,addOnce){if(eventName===undefined||handlerFunc===undefined){throw new Error("Dispatcher: Missing parameter")}if(typeof handlerFunc!=="function"){throw new Error("Dispatcher: handlerFunc is not an executable function")}function onceWrapperFunc(evtObj){if(deleteHandler(eventName,handlerFunc,true)){_remove(eventName,onceWrapperFunc)}handlerFunc(evtObj.type,evtObj.detail)}if(addOnce===true){if(registerHandler(eventName,handlerFunc,onceWrapperFunc,true)){_add(eventName,onceWrapperFunc)}return}var wrapperFunc=getWrapper(handlerFunc);if(registerHandler(eventName,handlerFunc,wrapperFunc,false)){_add(eventName,wrapperFunc)}};function findWrapperByHandler(dictionary,eventName,handlerFunc){if(!Array.isArray(dictionary[eventName])){return undefined}var record=dictionary[eventName].find(function(record){return record.original===handlerFunc});return record?record.wrapper:undefined}this.remove=function(eventName,handlerFunc){var wrapperFunc=findWrapperByHandler(wrappers,eventName,handlerFunc);if(wrapperFunc){deleteHandler(eventName,handlerFunc,false);_remove(eventName,wrapperFunc)}else{console.warn("Dispatcher: given handler is not registered for "+eventName+", so couldn't be removed")}};this.dispatch=function(eventName,data){var evt=new CustomEvent(eventName,{detail:data});_dispatch(evt)};function clearEvents(dictionary){var key,i,len,arr;for(key in dictionary){if(dictionary[key].length!==undefined){arr=dictionary[key];len=arr.length;i=0;for(i;i<len;i++){_remove(key,arr[i].wrapper)}dictionary[key]=null;delete dictionary[key]}}}this.destroy=function(){clearEvents(wrappers);clearEvents(onceWrappers)};this.addOnce=function(eventName,handlerFunc){this.add(eventName,handlerFunc,true)}}Dispatcher.prototype=Object.create(Reactor.prototype);"use strict";var Analytics;(function(){var GA="ga";var LOG_PREFIX="Spieler Analytics:";var log=console.log.bind(console,LOG_PREFIX);var info=console.info.bind(console,LOG_PREFIX);var error=console.error.bind(console,LOG_PREFIX);var warn=console.warn.bind(console,LOG_PREFIX);window.GoogleAnalyticsObject=GA;window[GA]||(window[GA]=function(){(window[GA].q=window[GA].q||[]).push(arguments)});window[GA].l=+new Date;dom.addScript("//www.google-analytics.com/analytics.js");window[GA]("create","UA-50238272-3","auto","spieler");Analytics={event:function(category,action,label,custom){log(Array.prototype.slice.call(arguments).join(" / "));custom&&Object.keys(custom).forEach(function(key){custom[key]=utils.safeToString(custom[key])});window[GA]("spieler.send","event",category,action,label,custom)}}})();function HookManager(){"use strict";this._hooks={};this._stack=[]}(function(){"use strict";HookManager.prototype={add:function(hook,func,name,prepend){var handler;if(this._stack.indexOf(hook)!==-1){throw new Error("refusing to add a function to a currently running hook")}if(this._hooks[hook]===undefined){this._hooks[hook]=[]}handler={func:func,name:name};if(prepend)this._hooks[hook].unshift(handler);else this._hooks[hook].push(handler);console.log("Spieler HookManager: added "+hook+"/"+name);return this},remove:function(hook,func,name){if(typeof func==="string"){name=func;func=null}var hookArray=this._hooks[hook];var removed;if(!hookArray){console.warn("Spieler HookManager: could not find hook "+hook);return}for(var i=0;i<hookArray.length;i++){if(hookArray[i]===null)continue;if(func&&hookArray[i].func===func||name&&hookArray[i].name===name){hookArray[i]=null;removed=true;break}}if(removed){console.log("Spieler HookManager: removed "+hook+"/"+name)}else{console.warn("Spieler Hookmanager: could not remove "+hook+"/"+name)}return this},exec:function(hook,data,callback){console.log("Spieler HookManager: executing hook "+hook);var hookArray=this._hooks[hook];if(!callback){callback=function(){}}if(!hookArray||!hookArray.length){callback(null);return this}var hookIndex=-1;var lastName;var self=this;this._stack.push(hook);function callNext(err,result){hookIndex++;if(err){console.error("Spieler HookManager: function failed "+hook+"/"+lastName);callback(err);return}else if(hookIndex>=hookArray.length){for(var i=0;i<hookArray.length;i++){if(!hookArray[i]){hookArray.splice(i,1)}}self._stack.pop();console.log("Spieler HookManager: hook finished: "+hook);callback(null,result)}else{if(!hookArray[hookIndex]){callNext(null,result);return}lastName=hookArray[hookIndex].name;console.log("Spieler HookManager: executing function "+hook+"/"+lastName);try{hookArray[hookIndex].func(result,callNext)}catch(caughtError){console.error("Spieler HookManager: function failed "+hook+"/"+lastName);callback(caughtError);return}}}callNext(null,data);return this},isEnabled:function(hookName){return this._hooks[hookName]!==undefined&&this._hooks[hookName].length>0}}})();function versionToArray(rawVersion){return typeof rawVersion=="string"?rawVersion.split(".").map(toInt):rawVersion}function versionToInt(rawVersion){return versionToArray(rawVersion).map(function(current,index,all){return current<<8*(all.length-index-1)}).reduce(sum)}function getFormatFromUrl(url,formats){var regex=new RegExp("(?:^|\\.)("+Object.keys(formats).join("|")+")(?:\\?|#|$|:)","i");var matches=url.match(regex);return matches!==null?matches[1]:null}function Media(denyFlash,dispatcher,onready){"use strict";var self=this;var formats={};var list=[];var original;var activeSource=-1;var activeQuality=0;var hasFlash=denyFlash?0:Spieler.browser.has.flash();var androidHLSSupportsVOD;var androidHLSSupportsLive;var androidVersion;var isValidResource=function(value){return value.hasOwnProperty("url")||isString(value)};var isString=function(value){return typeof value==="string"&&!!value.length};this.metadata=null;this.sources=list;this.formats=formats;function ready(){Object.assign(formats,{m3u8:{platform:HTML5HLS|HLSJS|FLASHHLS,mimeType:"application/vnd.apple.mpegURL",overrideCanplaytype:true,abs:true,mbs:FLASHHLS>0,playbackRateChangable:(HTML5HLS|HLSJS)>0},rtmp:{platform:FLASH,mbs:false,abs:false,playbackRateChangable:false},flv:{platform:FLASH,mbs:false,abs:false,playbackRateChangable:false},akamaihd:{platform:FLASHHDCORE,abs:true,playbackRateChangable:false},smil:{platform:FLASHHDCORE,abs:true,playbackRateChangable:false},mp4:{platform:HTML5||FLASH,mbs:true,playbackRateChangable:HTML5>0},webm:{platform:HTML5,abs:false,mbs:false,playbackRateChangable:false},f4m:{platform:FLASHHDCORE,abs:true,mbs:false,playbackRateChangable:false},mp3:{platform:HTML5,playbackRateChangable:false},wav:{platform:HTML5,playbackRateChangable:false}});setTimeout(function(){onready(self)},0)}this.load=function(res){if(res instanceof Media){res=res.getOriginalResource()}if(Array.isArray(res)){original=utils.extend(true,[],res);res=utils.extend(true,[],res)}else if(typeof res==="object"&&res!==null){original=utils.extend(true,{},res);res=utils.extend(true,{},res)}else if(typeof res==="string"){original=res.slice(0);res=res.slice(0)}else{original=res}this.metadata=Object.assign({},res.metadata||{});if(typeof res==="string"){res=[[res]]}else if(typeof res==="object"&&!res.length){var temp=[];if(res.url&&res.streamName){temp.push([res])}else{for(var f2 in res){if(formats[f2]){if(typeof res[f2]==="string"){temp.push([res[f2]])}else if(Array.isArray(res[f2])){temp.push(res[f2])}else{continue}temp[temp.length-1].format=f2}}}res=temp}res=res.map(function(value){return(Array.isArray(value)?value:[value]).filter(isValidResource)}).filter(function(value){return value.length});var initialResourcesLength=res.length;for(var f=0;f<res.length;f++){for(var q=0;q<res[f].length;q++){if(typeof res[f]==="string"){res[f]=[res[f]]}if(typeof res[f][q]==="string"){res[f][q]={url:res[f][q]}}else if(Array.isArray(res[f][q])||typeof res[f][q]==="object"&&!res[f][q].url){res[f].splice(q--,1)}}if(!res[f].format&&res[f].length){res[f].format=getFormatFromUrl(res[f][0].url,formats)}if(!formats[res[f].format]||!res[f].length){console.log("SpielerMedia: dropping unknown format (not defined in `formats`): "+res[c].format);res.splice(f--,1)}}var videoElement;var audioElement;var format;for(var c=0;c<res.length;c++){format=res[c].format;if(FLASH&&formats[format].platform&FLASH){res[c].platform=FLASH;list.push(res[c])}else if(FLASH&&formats[format].platform&FLASHHDCORE){res[c].platform=FLASHHDCORE;list.push(res[c])}else if(FLASH&&formats[format].platform&FLASHHLS){res[c].platform=FLASHHLS;list.push(res[c])}else if(formats[format].platform&HLSJS){if(!videoElement){videoElement=document.createElement("video")}res[c].platform=HLSJS;list.push(res[c])}else if(formats[format].platform&HTML5){if(!videoElement){videoElement=document.createElement("video")}if(!audioElement){audioElement=document.createElement("audio")}if(videoElement.canPlayType&&videoElement.canPlayType(formats[format].mimeType||"video/"+format)||formats[format].overrideCanplaytype){res[c].platform=HTML5;list.push(res[c])}else if(audioElement.canPlayType&&audioElement.canPlayType(formats[format].mimeType||"audio/"+format)||formats[format].overrideCanplaytype){res[c].platform=HTML5;list.push(res[c])}else{console.log("SpielerMedia: dropping unsupported format (canplaytype denied): "+res[c].format)}}else{console.log("SpielerMedia: dropping unsupported format: "+res[c].format)}}if(format==="mp3"||format==="wav"){this.metadata.audio=true}if(list.length){this.source(0)}else if(initialResourcesLength){this.source(-2)}};this.active=function(){return list&&list[activeSource]&&list[activeSource][activeQuality]?list[activeSource][activeQuality]:""};this.platform=function(){return activeSource>-1&&list[activeSource]?list[activeSource].platform:0};this.isFlashBasedPlatform=function(){var value;switch(this.platform()){case Media.PLATFORM.FLASH:case Media.PLATFORM.FLASHHDCORE:case Media.PLATFORM.FLASHHLS:value=true;break;case Media.PLATFORM.HLSJS:case Media.PLATFORM.HTML5:value=false;break;default:value=null}return value};this.format=function(){return activeSource>-1&&list[activeSource]?list[activeSource].format:""};this.destroy=function(){dispatcher.dispatch(Media.events.DESTROY)};this.source=function(source){if(source!==undefined&&source<list.length){activeSource=source;dispatcher.dispatch(Media.events.PLATFORMCHANGE,{media:this})}return activeSource};this.getOriginalResource=function(){return original};this.quality=function(value){if(value!=activeQuality&&value>=0&&value<this.qualities()){activeQuality=value}return activeQuality};this.qualities=function(){return list&&list[activeSource]?list[activeSource].length:-1};this.qualityList=function(){return list&&list[activeSource]?list[activeSource]:[]};this.absAvailable=function(){var format=formats[this.format()];return format&&format.abs};this.mbsAvailable=function(){var format=formats[this.format()];return format&&format.mbs};this.playbackRateChangable=function(){var format=formats[this.format()];return format&&format.playbackRateChangable};if(Spieler.browser.is.android&&Spieler.browser.is.android.length===3){androidVersion=versionToInt(Spieler.browser.is.android);if(androidVersion>=versionToInt("4.4.4")){androidHLSSupportsVOD=androidHLSSupportsLive=true}else if(androidVersion<versionToInt("4.4.4")&&androidVersion>=versionToInt("4.1.0")){androidHLSSupportsLive=true;androidHLSSupportsVOD=false}else{androidHLSSupportsLive=androidHLSSupportsVOD=false}console.log("SpielerMedia: Detected Android "+Spieler.browser.is.android.join(".")+", HLS Live Support: "+androidHLSSupportsLive+", HLS VOD Support: "+androidHLSSupportsVOD)}var FLASH=hasFlash?Media.PLATFORM.FLASH:0;var FLASHHDCORE=hasFlash?Media.PLATFORM.FLASHHDCORE:0;var FLASHHLS=hasFlash&&(!Spieler.browser.is.chrome&&!Spieler.browser.is.firefox)?Media.PLATFORM.FLASHHLS:0;var HTML5=Spieler.browser.supports.html5.video?Media.PLATFORM.HTML5:0;var HTML5HLS=0;var HLSJS=0;if(Spieler.browser.is.iOS||Spieler.browser.is.desktopSafari||Spieler.browser.is.edge){HTML5HLS=Media.PLATFORM.HTML5}else if(Spieler.browser.is.android){if(this.metadata&&this.metadata.live){HTML5HLS=androidHLSSupportsLive?Media.PLATFORM.HTML5:0}else{HTML5HLS=androidHLSSupportsVOD?Media.PLATFORM.HTML5:0}}if(HTML5HLS===0&&!Spieler.browser.is.opera&&Spieler.browser.supportsHlsJs()){HLSJS=Media.PLATFORM.HLSJS;ready()}else{ready()}}Media.events={DESTROY:"MEDIA.DESTROY",PLATFORMCHANGE:"MEDIA.PLATFORMCHANGE"};Media.PLATFORM={HTML5:1,FLASH:2,FLASHHDCORE:4,FLASHHLS:8,HLSJS:16};var NativeControlsManager;(function(){"use strict";var fs;var P="Spieler NativeControlsManager: ";NativeControlsManager=function(videoElement,dispatcher){fs=Spieler.browser.fs;console.log(P+"initialising on element ",videoElement);this._video=videoElement;this._dispatcher=dispatcher;this._inFullscreen=fs.isFullscreenElement(videoElement);this._lastControlsState=null;this._lastPassiveState=false;this._pauseTimeout=null;this._videoCover=null;utils.bindAll(this);this._dispatcher.add(Spieler.events.DESTROY,this._onDestroy);this._dispatcher.add(Spieler.events.DURATIONCHANGE,this._onDurationChange);this._dispatcher.add(Spieler.events.PASSIVESTATECHANGED,this._onPassiveStateChange)};NativeControlsManager.prototype={enable:function(noprop){console.log(P+"enabling native controls");this._lastControlsState=true;if(!noprop){this._video.controls=true}if(fs.isFullscreenElement(this._video)){this._inFullscreen=true}this._pauseTimeout&&clearTimeout(this._pauseTimeout);if(fs.html5){console.log(P+"listening to HTML5 fullcreenchange");dom.on(document,fs.changeEvent,this._onFullscreenchange)}else if(fs.native){console.log(P+"listening to native fullcreenchange");fs.nativeChangeEvents.forEach(function(ev){dom.on(this._video,ev,this._onFullscreenchange)}.bind(this))}this._videoCover=document.createElement("div");this._videoCover.className="ppVideoClick";this._video.parentNode.appendChild(this._videoCover);dom.on(this._videoCover,"click",this._onPlay);dom.on(this._video,"play",this._onPlay);dom.on(this._video,"pause",this._onPause);dom.addClass(this._video.parentNode.parentNode,"nativeControls")},disable:function(){console.log(P+"disabling native controls");this._lastControlsState=false;this._video.controls=false;if(fs.html5){dom.on(document,Browser.fullscreenChange,this._onFullscreenchange)}else if(fs.native){fs.nativeChangeEvents.forEach(function(ev){dom.on(this._video,ev,this._onFullscreenchange)}.bind(this))}if(Spieler.browser.is.ie){dom.off(this._video,"playing",this._onPlay)}else{dom.off(this._video,"play",this._onPlay)}if(this._videoCover!==null){dom.off(this._videoCover,"click",this._onPlay);this._videoCover.parentNode.removeChild(this._videoCover);this._videoCover=null}if(Spieler.browser.is.iOS){console.log("waiting to remove 'pause' callback");this._pauseTimeout=setTimeout(function(){console.log("removing 'pause' callback");dom.off(this._video,"pause",this._onPause)}.bind(this),5e3)}else{dom.off(this._video,"pause",this._onPause)}dom.removeClass(this._video.parentNode.parentNode,"nativeControls")},_onDestroy:function(){console.log(P+"goodbye, cruel world");this._dispatcher.remove(Spieler.events.DESTROY,this._onDestroy);this._dispatcher.remove(Spieler.events.DURATIONCHANGE,this._onDurationChange);this._dispatcher.remove(Spieler.events.PASSIVESTATECHANGED,this._onPassiveStateChange);this.disable()},_onFullscreenchange:function(){if(fs.isFullscreenElement(this._video)){console.log(P+"fullscreen change: enter");this._dispatcher.dispatch(Spieler.events.FULLSCREEN,{feedback:true});this._inFullscreen=true}else if(this._inFullscreen){console.log(P+"fullscreen change: leave");this._dispatcher.dispatch(Spieler.events.FULLSCREEN,{feedback:true});this._inFullscreen=false}},_onPassiveStateChange:function(eventName,newState){this._lastPassiveState=newState},_onPlay:function(){if(this._videoCover!==null){dom.off(this._videoCover,"click",this._onPlay);this._videoCover.parentNode.removeChild(this._videoCover);this._videoCover=null;if(Spieler.browser.is.ie){dom.on(this._video,"playing",this._onPlay)}else{dom.on(this._video,"play",this._onPlay)}}if(!this._lastPassiveState){this._dispatcher.dispatch(Spieler.events.PLAY,{feedback:true})}},_onPause:function(){if(!this._lastPassiveState){this._dispatcher.dispatch(Spieler.events.PAUSE,{feedback:true})}this._pauseTimeout&&clearTimeout(this._pauseTimeout)},_onDurationChange:function(){this._video.controls=this._lastControlsState}}})();var NativeFullscreenManager;var fs;(function(){"use strict";var P="Spieler NativeFullscreenManager: ";NativeFullscreenManager=function(videoElement,dispatcher,manageNativeControls){fs=Spieler.browser.fs;console.log(P+"initialising on element ",videoElement);this._video=videoElement;this._dispatcher=dispatcher;this._shouldBePlaying=false;this._prevSpielerTime=0;this._spielerTime=0;if(manageNativeControls){this._ncm=new NativeControlsManager(videoElement,dispatcher)}utils.bindAll(this);this._onFullscreenchange();this._dispatcher.add(Spieler.events.DESTROY,this._onDestroy);this._listen()};NativeFullscreenManager.prototype={enter:function(){if(this._video.readyState>0){console.log(P+"entering native fullscreen",fs.request);this._video[fs.request]()}else{console.error(P+"videoElement is not ready to go fullscreen");this._dispatcher.dispatch(Spieler.events.FULLSCREENERROR)}},inFullscreen:function(){return fs.isFullscreenElement(this._video)},exit:function(){console.log(P+"exiting native fullscreen",fs.exit,fs.exitNative);if(fs.html5){document[fs.exit]()}else if(fs.native){this._video[fs.exitNative]()}},_onDestroy:function(){console.log(P+"goodbye, cruel world");if(fs.html5){dom.off(document,fs.changeEvent,this._onFullscreenchange)}else if(fs.native){fs.nativeChangeEvents.forEach(function(ev){dom.off(this._video,ev,this._onFullscreenchange)}.bind(this))}this._dispatcher.remove(Spieler.events.FULLSCREEN,this._onSplFullscreen);this._dispatcher.remove(Spieler.events.DESTROY,this._onDestroy)},_onPlaying:function(){this._shouldBePlaying=true},_onPaused:function(){this._shouldBePlaying=false},_listen:function(){console.log(P+"listening");if(fs.html5){dom.on(document,fs.changeEvent,this._onFullscreenchange)}else if(fs.native){fs.nativeChangeEvents.forEach(function(ev){dom.on(this._video,ev,this._onFullscreenchange)}.bind(this))}this._dispatcher.add(Spieler.events.FULLSCREEN,this._onSplFullscreen)},_onFullscreenchange:function(){console.log(P+"fullscreen change");if(this._ncm){if(this.inFullscreen()){console.log(P+"please enable native controls");this._ncm.enable(Spieler.browser.is.iOS)}else{console.log(P+"please disable native controls");setTimeout(this._ncm.disable.bind(this._ncm),1e3)}}},_onSplTimeupdate:function(eventName,data){this._prevSpielerTime=this._spielerTime;this._spielerTime=data},_onSplEnd:function(eventName,data){this._prevSpielerTime=0},_onSplFullscreen:function(event,data){if(data){if(data.feedback){return}var method=null;switch(this.inFullscreen()){case true:if(data.toggle||data.exit){method="exit"}break;case false:if(data.toggle||data.enter){method="enter"}break}if(method!==null){this[method]();return}}throw new Error("illegal FULLSCREEN event")}}})();"use strict";function Reactor(){var target=document.createTextNode(null);this.addEventListener=target.addEventListener.bind(target);this.removeEventListener=target.removeEventListener.bind(target);this.dispatchEvent=target.dispatchEvent.bind(target)}"use strict";function Scope(){var data={};this.$register=function(variable,defaultValue){if(data.hasOwnProperty(variable)){this[variable]=defaultValue}else{data[variable]={oldValue:undefined,value:defaultValue,handlers:{}};Object.defineProperty(this,variable,{get:function ScopeGetter(){return data[variable].value},set:function ScopeSetter(newValue){if(data[variable].value===newValue){return}data[variable].oldValue=data[variable].value;data[variable].value=newValue;fire(variable,data[variable].value,data[variable].oldValue)}})}return this};this.$watch=function(variable,callback,thisObj){if(!data.hasOwnProperty(variable)){this.register(variable)}thisObj=thisObj||window;data[variable].handlers[callback]=function(newValue,oldValue){callback(newValue,oldValue)}.bind(thisObj);fire(variable,data[variable].value,data[variable].oldValue);return this};this.$unwatch=function(variable,callback){if(data.hasOwnProperty(variable)){data[variable].handlers=filterObject(data[variable].handlers,function(item){if(item===callback){return item}})}};var fire=function(variable,newValue,oldValue){var callback;for(var key in data[variable].handlers){if(!data[variable].handlers.hasOwnProperty(key)){continue}callback=data[variable].handlers[key];if(typeof callback==="function"){callback(newValue,oldValue)}}};function filterObject(object,predicate){return Object.entries(object).filter(function(kvPair){var key=kvPair[0];var value=kvPair[1];return predicate(value)}).reduce(function(obj,kvPair){var key=kvPair[0];var value=kvPair[1];obj[key]=value;return obj},{})}}(function(){"use strict";angular.module("ngSpieler",[]).directive("spieler",["$timeout",function($timeout){var currentResources=null;if(!window.Spieler){throw new Error("Spieler library is not loaded")}return{scope:{resources:"=?",basicUi:"=?",autoplay:"=?",denyFlash:"=?",poster:"=?",showPosterAtVideoEnd:"=?",playing:"=?",playState:"=?",noinit:"=?",volume:"=?",muted:"=?",quality:"=?",qualities:"=?",absAvailable:"=?",abs:"=?",mbsAvailable:"=?",qualitylist:"=?",currentTime:"=?",dfp:"=?",dfpPreroll:"=?",dfpSting:"=?",dfpPostroll:"=?",dfpMidroll:"=?",dfpOverlay:"=?",dfpOverlayBottom:"=?",dfpParameters:"=?",dfpUpdateConfig:"=?",onStreamurlNeeded:"=?",reinitOnResourceChange:"=?",googleTagManagerEvents:"=?",googleTagManagerDataLayerHandle:"=?",googleTagManagerTrackAds:"=?",nativeFullscreen:"=?",fullscreen:"=?",nativeControls:"=?",flashBlockDetector:"=?",adBlockDetector:"=?",playsInline:"=?",companionParameters:"=?",skin:"=?",dfpLocale:"=?",playbackRate:"=?"},link:function(scope,$element){var log=console.log.bind(console,"ngSpieler:");var error=console.error.bind(console,"ngSpieler:");var watchguards={playing:false,currentTime:false,quality:false,volume:false,muted:false,fullscreen:false,dfpUpdateConfig:false,abs:false};function watchguard(what,toRun){if(watchguards[what]){watchguards[what]=false}else{toRun()}}function getAllSpielerEventNames(){return Object.values(Spieler.plugins).filter(hasProp("events")).map(function(plugin){return Object.values(plugin.events)}).reduce(sumArray,Object.values(Spieler.events))}function bindToSpieler(dispatcher,callback,eventName){dispatcher.add(eventName,callback)}function bindEvents(spieler,handler){var bindToEvent=bindToSpieler.bind(null,spieler.dispatcher,handler);getAllSpielerEventNames().forEach(bindToEvent)}function getConfig(){var configObj={basicUi:scope.basicUi,denyFlash:scope.denyFlash,poster:scope.poster,showPosterAtVideoEnd:scope.showPosterAtVideoEnd||false,
autoplay:scope.playing,nativeControls:scope.nativeControls,plugins:{},volume:scope.volume,muted:scope.muted};var gtmconfig=getGoogleTagManagerConfig();var dfpConfig=getDfpConfig();if(scope.hasOwnProperty("nativeFullscreen")){configObj.nativeFullscreen=scope.nativeFullscreen}if(scope.adBlockDetector){configObj.plugins.adBlockDetector=true}if(scope.flashBlockDetector){configObj.plugins.flashBlockDetector=true}if(dfpConfig){configObj.plugins.dfp=dfpConfig}if(gtmconfig){configObj.plugins.googleTagManager=gtmconfig}if(scope.playsInline){configObj.playsInline=true}return configObj}function getDfpConfig(){var config=null;if(scope.dfp){if(scope.dfpUpdateConfig!=null){config=scope.dfpUpdateConfig;watchguards.dfpUpdateConfig=true}else{config={preroll:scope.dfpPreroll,sting:scope.dfpSting,midroll:scope.dfpMidroll,postroll:scope.dfpPostroll,overlay:scope.dfpOverlay,overlayBottom:scope.dfpOverlayBottom,parameters:scope.dfpParameters,companionParameters:scope.companionParameters,skin:scope.skin,locale:scope.dfpLocale}}log("DFP enabled:",config)}return config}function getGoogleTagManagerConfig(){var config=null;if(scope.googleTagManagerEvents){config={events:scope.googleTagManagerEvents.reduce(function(events,eventName){events[eventName]=true;return events},{}),trackAds:scope.googleTagManagerTrackAds};if(scope.googleTagManagerDataLayerHandle){config.dataLayerHandle=scope.googleTagManagerDataLayerHandle}log("googleTagManager enabled:",config)}return config}function safeApply(){var phase=scope.$root.$$phase;if(phase!=="$apply"&&phase!=="$digest"){scope.$apply()}}function createSpieler(force){if(!scope.spieler||force){var conf=getConfig();scope.spieler=new Spieler($element[0],scope.resources,conf);scope.playing=scope.spieler._state.playing;scope.muted=scope.spieler._state.muted;log("Instantiated Spieler for element",$element[0],"with resource: ",scope.resources?scope.resources:"none","with config",conf);if(scope.onStreamurlNeeded){scope.spieler.hooks.add("streamurl-needed",scope.onStreamurlNeeded,"ng-spieler-on-streamurl-needed")}if(scope.resources){currentResources=scope.resources}bindEvents(scope.spieler,function(eventName,data){scope.$emit(eventName,data,$element,scope.spieler)});createWatches();$element[0]._={spieler:scope.spieler,getAllSpielerEventNames:getAllSpielerEventNames};if(scope.spieler){scope.spieler.dispatcher.dispatch(Spieler.events.READY);log("READY for playing.")}}}function createWatches(){scope.$watch("resources",function(value,oldValue){if(value!==currentResources){if(scope.reinitOnResourceChange){scope.spieler.destroy();createSpieler(true)}else{try{scope.spieler.play(value);currentResources=value}catch(err){error("failed to load new resource:",value,err)}}if(value===currentResources){log("resource changed",value)}}});scope.$watch("currentTime",function(){watchguard("currentTime",function(){if(scope.currentTime!==null){scope.spieler.currentTime(scope.currentTime);log("seeked to position",scope.currentTime)}})});scope.$watch("playing",function(){watchguard("playing",function(){if(scope.playing!==scope.spieler.playing()&&!scope.spieler._state.poking){scope.spieler[scope.playing?"play":"pause"]();log("play state changed",scope.playing)}})});scope.$watch("quality",function(){watchguard("quality",function(){scope.spieler.quality(scope.quality);log("quality value changed",scope.quality)})});scope.$watch("volume",function(value){watchguard("volume",function(){if(parseFloat(value)!==scope.spieler.volume()){scope.spieler.volume(scope.volume);log("volume value changed: "+scope.volume)}})});scope.$watch("abs",function(){scope.spieler.abs(scope.abs);log("abs value changed")});scope.$watch("muted",function(){watchguard("muted",function(){scope.spieler.muted(scope.muted);log("muted value changed: "+scope.muted)})});scope.$watch("fullscreen",function(value,oldValue){watchguard("fullscreen",function(){if(value!==oldValue&&typeof value==="boolean"){scope.spieler.fullscreen(value);log("fullscreen changed: ",value,"was:",oldValue)}})});scope.$watch("playbackRate",function(){if(scope.playbackRate!==null){scope.spieler.playbackRate(scope.playbackRate)}});scope.$watch("dfpUpdateConfig",function(value){watchguard("dfpUpdateConfig",function(){if(value&&scope.spieler&&!scope.spieler.dfp){scope.spieler.laterUpdateConfig(value,scope.spieler._state.uninitialized)}else if(value&&scope.spieler&&scope.spieler.dfp){scope.spieler.dfp.updateConfig(value,scope.spieler._state.uninitialized);log("dfp config updated with value:",value)}})});scope.spieler.dispatcher.add(Spieler.events.FULLSCREEN,function(event,data){if(data){if(!data.feedback){var newValue=scope.fullscreen;if(data.enter){newValue=true}else if(data.exit){newValue=false}else if(data.toggle){newValue=!newValue}if(newValue!==scope.fullscreen){watchguards.fullscreen=true;scope.fullscreen=newValue}}else{var isInFullscreen=Spieler.browser.fs.isFullscreenElement($element[0].querySelector(scope.nativeFullscreen?"video":".ppMain"));if(scope.fullscreen!==isInFullscreen){watchguards.fullscreen=true;scope.fullscreen=isInFullscreen;log("updated fullscreen to "+scope.fullscreen+" (feedback)")}}safeApply()}});scope.spieler.dispatcher.add(Spieler.events.FULLSCREENERROR,function(event,data){$timeout(function(){watchguards.fullscreen=true;scope.fullscreen=false},100)});scope.spieler.dispatcher.add(Spieler.events.PLAY,function(event,data){if(!scope.playing){scope.playing=true;watchguards.playing=true;safeApply()}});scope.spieler.dispatcher.add(Spieler.events.GETSIZE,function(event,data){if(scope.spieler.playing()!==scope.playing){scope.playing=!scope.playing;watchguards.playing=true;safeApply()}});scope.spieler.dispatcher.add(Spieler.events.PAUSE,function(event,data){if(scope.playing){scope.playing=false;watchguards.playing=true;safeApply()}});scope.spieler.dispatcher.add(Spieler.events.PLAYING,function(event,data){scope.playState="playing";safeApply()});scope.spieler.dispatcher.add(Spieler.events.PAUSED,function(event,data){scope.playState="paused";safeApply()});scope.spieler.dispatcher.add(Spieler.events.END,function(event,data){if(scope.playing){scope.playing=false;watchguards.playing=true}scope.playState="stopped";safeApply()});scope.spieler.dispatcher.add(Spieler.events.POSTCLIPDONE,function(event,data){if(scope.playing){scope.playing=false;watchguards.playing=true}scope.playState="stopped";safeApply()});scope.spieler.dispatcher.add(Spieler.events.TIMEUPDATE,function(event,data){scope.currentTime=data;watchguards.currentTime=true;safeApply()});scope.spieler.dispatcher.add(Spieler.events.VOLUMECHANGE,function(event,data){if(data!==scope.volume){scope.volume=data;watchguards.volume=true;safeApply()}});scope.spieler.dispatcher.add(Spieler.events.MUTEDCHANGE,function(event,data){if(data!==scope.muted){scope.muted=data;watchguards.muted=true;safeApply()}});scope.spieler.dispatcher.add(Spieler.events.DURATIONCHANGE,function(event,data){scope.quality=scope.spieler.quality();watchguards.quality=true;scope.abs=scope.spieler.abs();watchguards.abs=true;scope.qualities=scope.spieler.qualities();scope.absAvailable=scope.spieler.absAvailable();scope.mbsAvailable=scope.spieler.mbsAvailable();scope.qualitylist=scope.spieler.qualityList();safeApply()});scope.spieler.dispatcher.add(Spieler.events.QUALITY,function(event,data){scope.quality=scope.spieler.quality();watchguards.quality=true;scope.abs=scope.spieler.abs();watchguards.abs=true;safeApply()})}$element.on("$destroy",function(){if(scope.spieler!==undefined){scope.spieler.destroy();scope.spieler=undefined}});if(!scope.noinit){log("sync init");createSpieler()}else{scope.$watch("noinit",function(value){if(!value){$timeout(function(){log("delayed init");createSpieler()})}})}}}}])})();
//# sourceMappingURL=ng-spieler.js.map
})(window);